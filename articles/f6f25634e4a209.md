---
title: "OAuth 2.1ã®å·®åˆ†ã‚’è¦‹å®ˆã‚‹ä¼š : draft 04-05"
emoji: "ğŸ™†"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["OAuth", "ietf", "rfc"]
published: true 
---

æœ¬æŠ•ç¨¿ã¯OAuth 2.1ã£ã¦å‘¼ã°ã‚ŒãŸã„æ„Ÿã‚’å‡ºã—ã¦ã‚‹ä»•æ§˜ã®å·®åˆ†ã‚’è¦‹å®ˆã‚‹ä¼šã§ã™ã€‚

æœ¬æŠ•ç¨¿å«ã‚ã€å·®åˆ†ã‚’ ã‚¹ã‚¯ãƒ©ãƒƒãƒ— - [OAuth 2.1ã‚’è¦‹å®ˆã‚‹ä¼š](https://zenn.dev/ritou/scraps/098107802f952b) ã§ã¾ã¨ã‚ã¦ã„ã¾ã™ã€‚

## å·®åˆ†

[å·®åˆ†](https://tools.ietf.org/wg/oauth/draft-ietf-oauth-v2-1/draft-ietf-oauth-v2-1-05-from-04.wdiff.html)

[draft 05](https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-05.txt) ã«ãŠã‘ã‚‹ä¸»ãªå·®åˆ†ã¨ã—ã¦ã¯ã€[Appendix E.  Document History](https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-05.txt#appendix-E)ã«è¨˜è¼‰ã®ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

>   *  Added a section about the removal of the implicit flow
>
>   *  Moved many normative requirements from security considerations
>     into the appropriate inline sections
>
>   *  Reorganized and consolidated TLS language
>
>   *  Require TLS on redirect URIs except for localhost/custom URL
>     scheme
>
>   *  Updated refresh token guidance to match security BCP
>

å¤‰æ›´å·®åˆ†ã®å…¨ä½“ã‚’è¦‹ã‚‹ã¨å¤šãã®å·®åˆ†ãŒã‚ã‚‹ã‚ˆã†ã«è¦‹ãˆã¾ã™ãŒã€Security Considerations ãªã©ã®ç« ã‹ã‚‰é©åˆ‡ãªç« ã«èª¬æ˜ãŒç§»å‹•ã—ãŸã“ã¨ã«ä¼´ã†ã‚‚ã®ãŒå¤šã„ã§ã™ã€‚ãã®ä»–ã«ã‚‚ TLS ã‚„ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã«é–¢ã™ã‚‹è¡¨ç¾ã®ç´°ã‹ã„ä¿®æ­£ãªã©ãŒå«ã¾ã‚Œã¾ã™ã€‚
draft 05 ã«ãŠã‘ã‚‹æœ€ã‚‚å¤§ããªå¤‰æ›´ã¯ã€ã€Œ10.1. Removal of the OAuth 2.0 Implicit grantã€ã¨ã„ã†ç« ã®è¿½åŠ ã«ãªã‚Šãã†ã§ã™ã€‚æ¬¡ã„ã§ã€ã€ŒRequire TLS on redirect URIs except for localhost/custom URL schemeã€ã§ã—ã‚‡ã†ã‹ã€‚
æœ¬æŠ•ç¨¿ã§ã¯ã€ä¸Šè¨˜ã®å†…å®¹ã‚’æŠ‘ãˆã¤ã¤ã€ãã®ä»–ã®ç´°ã‹ã„å¤‰æ›´ç‚¹ã«ã¤ã„ã¦ã‚‚ã€ã–ã£ãã‚Šã¨ç¢ºèªã—ã¦ã„ãã¾ã™ã€‚

### ç›®æ¬¡

ç›®æ¬¡ã«ãŠã‘ã‚‹ä¸»ãªå·®åˆ†ã¨ã—ã¦ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã—ãŸã€‚ãªãŠã€ã€Œ10.1. Removal of the OAuth 2.0 Implicit grantã€ã‚’é™¤ãã€å®Œå…¨ã«æ–°è¦ã§è¿½åŠ ã•ã‚ŒãŸç« ã¯ãªã•ãã†ã§ã—ãŸã€‚ä¸€è¦‹æ–°è¦ã§è¿½åŠ ã•ã‚ŒãŸã‚ˆã†ã«è¦‹ãˆã‚‹ç« ã‚‚ã€å…ƒã€…åˆ¥ã®ç« ã«ã¦è¨˜è¼‰ã•ã‚Œã¦ã„ãŸå†…å®¹ã‚’æŠœãå‡ºã—ã¦ã„ã‚‹ã ã‘ã®ã‚ˆã†ã§ã—ãŸã€‚

- TLS Version -> Communication security (å¤‰æ›´)
- Endpoint Request Confidentiality (å‰Šé™¤)
- Preventing CSRF Attacks (è¿½åŠ )
- Preventing Mix-Up Attacks (è¿½åŠ )
- Refresh Tokens (å‰Šé™¤)
- Request Confidentiality (å‰Šé™¤)
- Removal of the OAuth 2.0 Implicit grant (è¿½åŠ )
- Security Considerations in Native Apps (è¿½åŠ )

### 1.5. Communication security

ç« ã®ã‚¿ã‚¤ãƒˆãƒ«ãŒã€ŒTLS Versionã€ã‹ã‚‰ã€ŒCommunication securityã€ã«å¤‰ã‚ã£ã¦ã„ã¾ã™ã€‚
å†…å®¹ã«é–¢ã—ã¦ã¯ã€draft 04 ã®ã€Œ1.5.  TLS Versionã€ã§ã¯ã€é©åˆ‡ãªãƒãƒ¼ã‚¸ãƒ§ãƒ³ã® TLS ã‚’ã„ã¤ã§ã‚‚åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒè¦ä»¶ã¨ã—ã¦è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã—ãŸãŒã€ã€ŒCommunication securityã€ã§ã¯ã€TLS ã«é™å®šã—ãªã„ã‚ˆã†ãªè¨˜è¼‰ã«è¡¨ç¾ãŒå¤‰æ›´ã•ã‚Œã¦ã„ã¾ã™ã€‚

>    Implementations MUST use a mechanism to provide communication authentication, integrity and confidentiality such as Transport-Layer Security [RFC8446], to protect the exchange of clear-text credentials and tokens either in the payload body or in header fields from eavesdropping, tampering, and message forgery (eg. see Section 2.4.1, Section 7.6, Section 3.2, and Section 5.2).

ãªãŠã€ãƒ«ãƒ¼ãƒ—ãƒãƒƒã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ URI ã¯ä¾‹å¤–ã¨ã—ã¦ http ã‚¹ã‚­ãƒ¼ãƒ ã‚’åˆ©ç”¨ã—ã¦ã‚‚è‰¯ã„ã¨ã®è¨˜è¼‰ãŒè¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ã€‚

>    OAuth URLs MUST use the https scheme except for loopback interface redirect URIs, which MAY use the http scheme. 

ã¾ãŸã€TLS ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŠã‚ˆã³åˆ©ç”¨ã•ã‚Œã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯ã“ã®ä»•æ§˜ã®ç¯„å›²å¤–ã§ã‚ã‚‹ã“ã¨ãŒæ˜è¨˜ã•ã‚Œã¾ã—ãŸã€‚

>    The identification of the TLS versions and algorithms is outside the scope of this specification. 

### 3.1.  Authorization Endpoint

ä»¥ä¸‹ã®èªå¯ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ãŠã‘ã‚‹è¦ä»¶ã¯ draft 05 ã«ã¦æ–°ã—ãè¿½è¨˜ã•ã‚ŒãŸã‚‚ã®ã®ã‚ˆã†ã§ã™ã€‚èªå¯ã‚µãƒ¼ãƒãƒ¼ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã‚’å«ã‚€å¯èƒ½æ€§ãŒã‚ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹å ´åˆã€èª¤ã£ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã‚’è»¢é€ã™ã‚‹ã“ã¨ã‚’é¿ã‘ãªã‘ã‚Œã°ãªã‚‰ãªã„ (MUST)ã€€ã¨ã®ã“ã¨ã§ã™ã€‚

>    An authorization server that redirects a request potentially containing user credentials MUST avoid forwarding these user credentials accidentally (see Section 7.5.2 for details).

### 4.1.3.  Token Endpoint Extension

redirect_uri ã®æ¤œè¨¼ã«ã¤ã„ã¦ã€èªå¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã« redirect_uri ãŒå«ã¾ã‚Œã¦ã„ãªã‹ã£ãŸå ´åˆã«ã€redirect_uri ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã¯ OPTIONAL ã«ãªã‚‹ã“ã¨ãŒè¿½è¨˜ã•ã‚Œã¾ã—ãŸã€‚

>    "redirect_uri":  REQUIRED, if the redirect_uri parameter was included in the authorization request as described in Section 4.1.1, and in which case their values MUST be identical.  If no redirect_uri was included in the authorization request, this parameter is OPTIONAL.

### 4.3.  Refresh Token Grant

draft 04 ã®ã€Œ7.5.  Refresh Tokensã€ã«è¨˜è¼‰ã•ã‚Œã¦ã„ãŸå†…å®¹ãŒã“ã®ç« ã«è¨˜è¼‰ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ãŒã€å†…å®¹è‡ªä½“ã®å·®åˆ†ã¯è¡¨ç¾ãŒå¾®å¦™ã«é•ã†ãã‚‰ã„ã«è¦‹å—ã‘ã‚‰ã‚Œã¾ã—ãŸã€‚ãªãŠã€ãã®ä»–ã®ç« ã®å·®åˆ†ã‚’ç¢ºèªã—ã¦ã‚‚ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã®èª¬æ˜ã«é–¢ã™ã‚‹ã‚³ãƒ¬ã¨ã„ã£ãŸå·®åˆ†ã¯è¦‹å—ã‘ã‚‰ã‚Œãšã€ã€ŒUpdated refresh token guidance to match security BCPã€ã¨ã¯ã©ã®éƒ¨åˆ†ã‚’æŒ‡ã—ã¦ã„ã‚‹ã®ã‹ä¸æ˜ã§ã™ã€‚

### 5.2.  Bearer Tokens

draft 04 ã®ã€Œ7.1.2.  Threat Mitigationã€ã‚„ã€Œ1.4.  Access Tokenã€ã«è¨˜è¼‰ã•ã‚Œã¦ã„ãŸä¸€éƒ¨ã®å†…å®¹ã«ã¤ã„ã¦ã€è¡¨ç¾ãŒå¤‰æ›´ã•ã‚Œã¤ã¤ã€å†…å®¹ã‚‚è¿½è¨˜ã•ã‚Œã€ã€Œ5.2.  Bearer Tokensã€ã«è¨˜è¼‰ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã—ãŸã€‚
ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ãŒãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—ã®å ´åˆã®è¦ä»¶ãŠã‚ˆã³ã€JWT ãªã©ã®å½¢å¼ã«ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸå ´åˆã®è¦ä»¶ãŒãã‚Œãã‚Œè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

>    There is no requirement on the particular structure or format of a bearer token, as described in Section 5.  If a bearer token is a reference to authorization information, such references MUST be infeasible for an attacker to guess, such as using a sufficiently long cryptographically random string.  If a bearer token uses an encoding mechanism to contain the authorization information in the token itself, the access token MUST use integrity protection sufficient to prevent the token from being modified.  One example of an encoding and signing mechanism for access tokens is described in JSON Web Token Profile for Access Tokens [RFC9068].

### 10.1.  Removal of the OAuth 2.0 Implicit grant

draft 05 ã«ã¦æ–°ã—ãè¿½è¨˜ã•ã‚ŒãŸç« ã§ã™ã€‚

ä»¥å‰ã‚ˆã‚Šã€Œ10.  Differences from OAuth 2.0ã€ã«ã¦ã€OAuth 2.0 ã® Implicit Grant ã¯ OAuth2.1 ã§ã¯çœã‹ã‚Œã‚‹ã¨è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã—ãŸãŒã€ã“ã®ç« ã«ãŠã„ã¦ã‚‚æ˜è¨˜ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

>   The OAuth 2.0 Implicit grant is omitted from OAuth 2.1 as it was deprecated in [I-D.ietf-oauth-security-topics].

ã¾ãŸã€OAuth 2.1 ã«ã¦ Implicit Grant ã‚’å‰Šé™¤ã™ã‚‹ç›®çš„ãŒä»¥ä¸‹ã®é€šã‚Šè¨˜è¼‰ã•ã‚Œã¾ã—ãŸã€‚å…·ä½“ä¾‹ã¨ã—ã¦ã€ãƒˆãƒ¼ã‚¯ãƒ³ã®æ¼æ´©ã‚„ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã«å¯¾ã—ã¦è„†å¼±ã§ã‚ã‚‹ã“ã¨ã‚„ã€ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ sender-constrained ã¨ã—ã¦æ‰±ãˆãªã„ã“ã¨ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

>   The intent of removing the Implicit grant is to no longer issue access tokens in the authorization response, as such tokens are vulnerable to leakage and injection, and are unable to be sender-constrained to a client.  This behavior was indicated by clients using the response_type=token parameter.  This value for the response_type parameter is no longer defined in OAuth 2.1.

æœ€å¾Œã« "response_type=token" ã®å‰Šé™¤ã¯ã€OpenID Connect ã§å®šç¾©ã•ã‚ŒãŸ "response_type=id_token" ãªã©ã®æ‹¡å¼µã«å¯¾ã—ã¦å½±éŸ¿ã—ãªã„ã“ã¨ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

>   Removal of response_type=token does not have an effect on other extension response types returning other artifacts from the authorization endpoint, for example, response_type=id_token defined by [OpenID].

### çµ‚ã‚ã‚Š

ä»Šå›ã¯å·®åˆ†ãŒãŸãã•ã‚“ã‚ã‚‹ã‚ˆã†ã«è¦‹ãˆã¦ã€å®Ÿã¯ã»ã¨ã‚“ã©è¨˜è¼‰ã•ã‚Œã‚‹ç« ãŒå¤‰ã‚ã£ãŸã ã‘ã¿ãŸã„ãªæ„Ÿã˜ã§ã—ãŸã€‚
ã§ã¯ã¾ãŸï¼