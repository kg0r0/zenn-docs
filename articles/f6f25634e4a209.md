---
title: "OAuth 2.1ã®å·®åˆ†ã‚’è¦‹å®ˆã‚‹ä¼š : draft 04-05"
emoji: "ğŸ™†"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["OAuth", "ietf", "rfc"]
published: false
---

æœ¬æŠ•ç¨¿ã¯OAuth 2.1ã£ã¦å‘¼ã°ã‚ŒãŸã„æ„Ÿã‚’å‡ºã—ã¦ã‚‹ä»•æ§˜ã®å·®åˆ†ã‚’è¦‹å®ˆã‚‹ä¼šã§ã™ã€‚

æœ¬æŠ•ç¨¿å«ã‚ã€å·®åˆ†ã‚’ ã‚¹ã‚¯ãƒ©ãƒƒãƒ— - [OAuth 2.1ã‚’è¦‹å®ˆã‚‹ä¼š](https://zenn.dev/ritou/scraps/098107802f952b) ã§ã¾ã¨ã‚ã¦ã„ã¾ã™ã€‚

## å·®åˆ†

[å·®åˆ†](https://tools.ietf.org/wg/oauth/draft-ietf-oauth-v2-1/draft-ietf-oauth-v2-1-05-from-04.wdiff.html)

[draft 05](https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-05.txt) ã«ãŠã‘ã‚‹ä¸»ãªå·®åˆ†ã¨ã—ã¦ã¯ã€[Appendix E.  Document History](https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-05.txt#appendix-E)ã«è¨˜è¼‰ã®ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚
å¤‰æ›´å·®åˆ†ã®å…¨ä½“ã‚’è¦‹ã‚‹ã¨å¤šãã®å·®åˆ†ãŒã‚ã‚‹ã‚ˆã†ã«è¦‹ãˆã¾ã™ãŒã€ç« ã®ç§»å‹•ãªã©ã«ä¼´ã†ã‚‚ã®ãŒå¤šãã†ã§ã™ã€‚å¤§ããªå¤‰æ›´ã§è¨€ã†ã¨ã€implicit flow ã®å‰Šé™¤ã«é–¢ã™ã‚‹ç« ã®è¿½åŠ ã§ã—ã‚‡ã†ã‹ã€‚ãã®ä»–ã«ã‚‚ç‰¹ã« TLS ã«é–¢ã™ã‚‹æ¯”è¼ƒçš„ç´°ã‹ã„è¦ä»¶ãŒè‰²ã€…ã¨æ›´æ–°ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

>   *  Added a section about the removal of the implicit flow
>
>  *  Moved many normative requirements from security considerations
>     into the appropriate inline sections
>
>   *  Reorganized and consolidated TLS language
>
>   *  Require TLS on redirect URIs except for localhost/custom URL
>     scheme
>
> *  Updated refresh token guidance to match security BCP
>

æœ¬æŠ•ç¨¿ã§ã¯ã€ä¸Šè¨˜ã®å†…å®¹ã‚’æŠ‘ãˆã¤ã¤ã€ãã®ä»–ã®ç´°ã‹ã„å¤‰æ›´ç‚¹ã«ã¤ã„ã¦ã‚‚ã€ã–ã£ãã‚Šã¨ç¢ºèªã—ã¦ã„ãã¾ã™ã€‚

### ç›®æ¬¡

ç›®æ¬¡ã«ãŠã‘ã‚‹å¤§ããªå·®åˆ†ã¨ã—ã¦ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã—ãŸã€‚ãã®ä»–ã®å·®åˆ†ã«ã¤ã„ã¦ã¯ã€ç« ã®å ´æ‰€ãŒç§»å‹•ã—ãŸã ã‘ã®ã‚‚ã®ã§ã‚ã‚Šã€ç‰¹ã«å‰Šé™¤ã•ã‚ŒãŸã‚Šã€æ–°è¦ã«è¿½åŠ ã•ã‚ŒãŸã‚‚ã®ã¯ç„¡ã•ãã†ã§ã—ãŸã€‚

- TLS Version -> Communication security (å¤‰æ›´)
- Endpoint Request Confidentiality (å‰Šé™¤)
- Preventing CSRF Attacks (è¿½åŠ )
- Preventing Mix-Up Attacks (è¿½åŠ )
- Refresh Tokens (å‰Šé™¤)
- Request Confidentiality (å‰Šé™¤)
- Removal of the OAuth 2.0 Implicit grant (è¿½åŠ )
- Security Considerations in Native Apps (è¿½åŠ )

### 1.5. Communication security

ç« ã®ã‚¿ã‚¤ãƒˆãƒ«ãŒã€ŒTLS Versionã€ã‹ã‚‰ã€ŒCommunication securityã€ã«å¤‰ã‚ã£ã¦ã„ã¾ã™ã€‚
å†…å®¹ã«é–¢ã—ã¦ã¯ã€ä»¥å‰ã®ã€ŒTLS Versionã€ã§ã¯ã€ã–ã£ãã‚Šé©åˆ‡ãªãƒãƒ¼ã‚¸ãƒ§ãƒ³ã® TLS ã‚’ã„ã¤ã§ã‚‚åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒè¦ä»¶ã¨ã—ã¦è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã—ãŸãŒã€ã€ŒCommunication securityã€ã§ã¯ã€TLS ã«é™å®šã—ãªã„ã‚ˆã†ãªè¨˜è¼‰ã«è¡¨ç¾ãŒå¤‰æ›´ã•ã‚Œã¦ã„ã¾ã™ã€‚

>    Implementations MUST use a mechanism to provide communication authentication, integrity and confidentiality such as Transport-Layer Security [RFC8446], to protect the exchange of clear-text credentials and tokens either in the payload body or in header fields from eavesdropping, tampering, and message forgery (eg. see Section 2.4.1, Section 7.6, Section 3.2, and Section 5.2).

ãªãŠã€ãƒ«ãƒ¼ãƒ—ãƒãƒƒã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ URI ã¯ä¾‹å¤–ã¨ã—ã¦ http ã‚¹ã‚­ãƒ¼ãƒ ã‚’åˆ©ç”¨ã—ã¦ã‚‚è‰¯ã„ã¨ã®è¨˜è¼‰ãŒè¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ã€‚

>    OAuth URLs MUST use the https scheme except for loopback interface redirect URIs, which MAY use the http scheme. 

ã¾ãŸã€TLS ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŠã‚ˆã³åˆ©ç”¨ã•ã‚Œã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯ã“ã®ä»•æ§˜ã®ç¯„å›²å¤–ã§ã‚ã‚‹ã“ã¨ãŒæ˜è¨˜ã•ã‚Œã¾ã—ãŸã€‚

>    The identification of the TLS versions and algorithms is outside the scope of this specification. 

### 2.3.2. Registration Requirements

draft 04 ã® 7.3. Registration of Native App Clients ã‚„  7.7. Protecting the Authorization Code Flow ã«è¨˜è¼‰ã•ã‚Œã¦ã„ãŸç™»éŒ²ã«é–¢ã™ã‚‹è¦ä»¶ãŒã“ã®ç« ã«è¨˜è¼‰ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã—ãŸã€‚

### 2.3.3. Preventing CSRF Attacks

draft 04 ã® 7.7.  Protecting the Authorization Code Flow ã«è¨˜è¼‰ã•ã‚Œã¦ã„ãŸ CSRF Attack ã®tå¯¾ç­–ã«é–¢ã™ã‚‹è¦ä»¶ãŒä¸€ã¤ã®ç« ã¨ã—ã¦è¨˜è¼‰ã•ã‚Œã¾ã—ãŸã€‚

### 2.3.4. Preventing Mix-Up Attacks

draft 04 ã® Protecting the Authorization Code Flow ã«è¨˜è¼‰ã•ã‚Œã¦ã„ãŸ Mix-Up Attack ã®å¯¾ç­–ã«é–¢ã™ã‚‹è¦ä»¶ãŒä¸€ã¤ã®ç« ã¨ã—ã¦è¨˜è¼‰ã•ã‚Œã¾ã—ãŸã€‚

### 2.4.  Client Authentication

draft 04 ã® 2.4.  Client Authentication ã¨ 7.2.  Client Authentication ã«è¨˜è¼‰ã•ã‚Œã¦ã„ãŸå†…å®¹ãŒã“ã®ç« ã«ã¾ã¨ã‚ã‚‰ã‚ŒãŸã¦ã„ã¾ã—ãŸã€‚

### 3.1.  Authorization Endpoint

>    An authorization server that redirects a request potentially containing user credentials MUST avoid forwarding these user credentials accidentally (see Section 7.5.2 for details).

### 4.1.1.  Authorization Request

draft 04 ã® 7.8.  Authorization Codes ã¨ 7.9.  Request Confidentiality ã«è¨˜è¼‰ã•ã‚Œã¦ã„ãŸä¸€éƒ¨ã®è¦ä»¶ãŒã“ã®ç« ã«è¨˜è¼‰ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

### 4.1.2.  Authorization Response

draft 04 ã® 7.8.  Authorization Codes ã«è¨˜è¼‰ã•ã‚Œã¦ã„ãŸä¸€éƒ¨ã®è¦ä»¶ãŒã“ã®ç« ã«è¨˜è¼‰ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

### 4.1.3.  Token Endpoint Extension

redirect_uri ã®æ¤œè¨¼ã«ã¤ã„ã¦ã€èªå¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã« redirect_uri ãŒå«ã¾ã‚Œã¦ã„ãªã‹ã£ãŸå ´åˆã«ã€redirect_uri ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã¯ OPTIONAL ã«ãªã‚‹ã“ã¨ãŒè¿½è¨˜ã•ã‚Œã¾ã—ãŸã€‚

>    "redirect_uri":  REQUIRED, if the redirect_uri parameter was included in the authorization request as described in Section 4.1.1, and in which case their values MUST be identical.  If no redirect_uri was included in the authorization request, this parameter is OPTIONAL.


### 4.3.  Refresh Token Grant

draft 04 ã® 7.5.  Refresh Tokens ã«è¨˜è¼‰ã•ã‚Œã¦ã„ãŸä¸€éƒ¨ã®å†…å®¹ãŒã“ã®ç« ã«è¨˜è¼‰ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

### 5.2.  Bearer Tokens

draft 04 ã® 7.1.2.  Threat Mitigation ã‚„ 1.4.  Access Token ã«è¨˜è¼‰ã•ã‚Œã¦ã„ãŸä¸€éƒ¨ã®å†…å®¹ãŒè¡¨ç¾ã‚’å¤‰æ›´ã•ã‚Œã¤ã¤ã€ä¸€éƒ¨å†…å®¹ã‚‚è¿½è¨˜ã™ã‚‹å½¢ã§ã“ã®ç« ã«è¨˜è¼‰ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

>    To mitigate the risk of access token capture and replay, the lifetime of the token MUST be limited.  One means of achieving this is by putting a validity time field inside the protected part of the token. Note that using short-lived tokens reduces the impact of them being leaked.

>    There is no requirement on the particular structure or format of a bearer token, as described in Section 5.  If a bearer token is a reference to authorization information, such references MUST be infeasible for an attacker to guess, such as using a sufficiently long cryptographically random string.  If a bearer token uses an encoding mechanism to contain the authorization information in the token itself, the access token MUST use integrity protection sufficient to prevent the token from being modified.  One example of an encoding and signing mechanism for access tokens is described in JSON Web Token Profile for Access Tokens [RFC9068].

### 8.5. Security Considerations in Native Apps

ä»¥å‰ã¯ Security Considerations ã«ã¾ã¨ã‚ã‚‰ã‚Œã¦ã„ãŸ Native App ã® Security Consideration ãŒã€ãã‚Œã ã‘ã§æ–°è¦ã®ç« ã¨ã—ã¦è¿½è¨˜ã•ã‚Œã¾ã—ãŸã€‚
å†…å®¹ã¯ä»¥å‰ Security Considerations ã§è¨˜è¼‰ã•ã‚Œã¦ã„ãŸã‚‚ã®ã¨å¤§å·®ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚

### 10.1.  Removal of the OAuth 2.0 Implicit grant

>   The OAuth 2.0 Implicit grant is omitted from OAuth 2.1 as it was deprecated in [I-D.ietf-oauth-security-topics].

>   The intent of removing the Implicit grant is to no longer issue access tokens in the authorization response, as such tokens are vulnerable to leakage and injection, and are unable to be sender-constrained to a client.  This behavior was indicated by clients using the response_type=token parameter.  This value for the response_type parameter is no longer defined in OAuth 2.1.

>   Removal of response_type=token does not have an effect on other extension response types returning other artifacts from the authorization endpoint, for example, response_type=id_token defined by [OpenID].

### çµ‚ã‚ã‚Š

ã§ã¯ã¾ãŸï¼