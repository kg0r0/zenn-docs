---
title: "[å‚™å¿˜éŒ²] @auth0/mdl ã§ mDL ã‚’ç†è§£ã™ã‚‹ãŸã‚ã®ãƒ¡ãƒ¢"
emoji: "ğŸªª"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["nodejs"]
published: false
---

# ã¯ã˜ã‚ã«

ã“ã®è¨˜äº‹ã¯ @auth0/mdl [^1] ã¨ã„ã† mDL (mobile Driver Licenses) ã®ç™ºè¡ŒãŠã‚ˆã³æ¤œè¨¼ãŒå¯èƒ½ãª Node.js ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å‹•ã‹ã—ãªãŒã‚‰ mDL ã®ä»•æ§˜ã«æƒ³ã„ã‚’é¦³ã›ãŸéš›ã®ãŸã ã®å€‹äººãƒ¡ãƒ¢ã§ã™ã€‚ãŸã ã®å€‹äººãƒ¡ãƒ¢ã§ã‚ã‚Šã€å†…å®¹ã®æ­£ç¢ºæ€§ã¯ä¿è¨¼ã•ã‚Œãšã€å®šæœŸçš„ã«å†…å®¹ã®æ›´æ–°ãŒè¡Œã‚ã‚Œã‚‹å¯èƒ½æ€§ãŒé«˜ã„ç‚¹ã«ç•™æ„ã—ã¦ãã ã•ã„ã€‚

@auth0/mdl ã¯ ISO/IEC 18013-5 [^2] ã‚„ ISO/IEC 18013-7 [^3]ã¨ã„ã£ãŸä»•æ§˜ã«åŸºã¥ã„ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚ç¾æ™‚ç‚¹ã«ãŠã„ã¦ã€å‰è¿°ã®ä»•æ§˜ã¯ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’è³¼å…¥ã—ãŸä¸Šã§èª­ã‚€å¿…è¦ãŒã‚ã‚‹ã®ãŸã‚ã€ç„¡æ–™ã§å…¬é–‹ã•ã‚Œã¦ãŠã‚Šè©³ã—ã„è§£èª¬ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹è¨˜äº‹ [^4] ãªã©ã‚’é©å®œå‚ç…§ã™ã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚

æœ¬è¨˜äº‹ã§ã¯ã€è«¸ã€…ã®æ•´ç†ã«ã‚ãŸã£ã¦ä»¥ä¸‹ã®æŠ½è±¡åŒ–ã—ãŸ mDL ecosystem ã®å›³ã‚’ã‚‚ã¨ã«ãŠã“ãªã„ã¾ã™ã€‚ã¾ãŸã€Data model ãŠã‚ˆã³ Data exchange ã®è¦³ç‚¹ã§æ•´ç†ã‚’è¡Œã„ã¾ã™ã€‚

![mDL interfaces](/images/792909b06d11bd/mDL_interfaces.png)

ãªãŠã€æœ¬è¨˜äº‹ã§è©¦ã—ãŸéš›ã®ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®ãƒªãƒã‚¸ãƒˆãƒªã«å‹•ä½œç¢ºèªå¯èƒ½ãªçŠ¶æ…‹ã§é…ç½®ã—ã¾ã™ã€‚

https://github.com/kg0r0/node-mdl-example

# Data model

ã“ã“ã§ã¯ã€credential ã®ç™ºè¡ŒãŠã‚ˆã³æ¤œè¨¼ã«ã¤ã„ã¦æ•´ç†ã—ã¾ã™ã€‚
ãªãŠã€ã‚ãã¾ã§ Data model ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã—ãŸä¸Šã§ã®æ•´ç†ã§ã‚ã‚Šã€credential ãŒã©ã®ã‚ˆã†ã« Issuing authority ã‚„ mDL holderã€mDL holder ã‚„ mDL verifier é–“ã§æ¸¡ã•ã‚Œã‚‹ã‹ã«ã¤ã„ã¦ã¯ã‚¹ã‚³ãƒ¼ãƒ—å¤–ã§ã™ã€‚

## Issuing authority <-> mDL holder

```js
import { MDoc, Document } from "@auth0/mdl";
import { inspect } from "node:util";

...

  {
    let issuerPrivateKey;
    let issuerCertificate;
    let devicePublicKey; // the public key for the device, as a JWK

    const document = await new Document('org.iso.18013.5.1.mDL')
      .addIssuerNameSpace('org.iso.18013.5.1', {
        family_name: 'Jones',
        given_name: 'Ava',
        birth_date: '2007-03-25',
      })
      .useDigestAlgorithm('SHA-256')
      .addValidityInfo({
        signed: new Date(),
      })
      .addDeviceKeyInfo({ deviceKey: devicePublicKey })
      .sign({
        issuerPrivateKey,
        issuerCertificate,
        alg: 'ES256',
      });

    issuerMDoc = new MDoc([document]).encode();
  }
```

**Output:**

```
<Buffer b9 00 03 67 76 65 72 73 69 6f 6e 63 31 2e 30 69 64 6f 63 75 6d 65 6e 74 73 81 a2 67 64 6f 63 54 79 70 65 75 6f 72 67 2e 69 73 6f 2e 31 38 30 31 33 2e ... 1755 more bytes>
```

## mDL holder <-> mDL verifier

```js
import { MDoc, Document } from "@auth0/mdl";
import { inspect } from "node:util";

...

  {
    let devicePrivateKey; // the private key for the device, as a JWK

    // Parameters coming from the OID4VP transaction
    let mdocGeneratedNonce, clientId, responseUri, verifierGeneratedNonce;
    let presentationDefinition = {
      id: 'family_name_only',
      input_descriptors: [
        {
          id: 'org.iso.18013.5.1.mDL',
          format: { mso_mdoc: { alg: ['EdDSA', 'ES256'] } },
          constraints: {
            limit_disclosure: 'required',
            fields: [{
                path: ["$['org.iso.18013.5.1']['family_name']"],
                intent_to_retain: false,
              }],
          },
        },
      ],
    };

    deviceResponseMDoc = await DeviceResponse.from(issuerMDoc)
      .usingPresentationDefinition(presentationDefinition)
      .usingSessionTranscriptForOID4VP(mdocGeneratedNonce, clientId, responseUri, verifierGeneratedNonce)
      .authenticateWithSignature(devicePrivateKey, 'ES256')
      .sign();
  }
```

**Output:**

```js
MDoc {
  documents: [
    DeviceSignedDocument {
      docType: 'org.iso.18013.5.1.mDL',
      issuerSigned: [Object],
      deviceSigned: [Object]
    }
  ],
  version: '1.0',
  status: 0,
  documentErrors: []
}
```


## mDL holder <-> mDL verifier

```js
import { Verifier } from "@auth0/mdl";
import { inspect } from "node:util";
import fs from "node:fs";

(async () => {
  const encodedDeviceResponse = Buffer.from(encodedDeviceResponseHex, 'hex');
  const encodedSessionTranscript = Buffer.from(encodedSessionTranscriptHex, 'hex');
  const ephemeralReaderKey = Buffer.from(ephemeralReaderKeyHex, 'hex');

  const trustedCerts = [fs.readFileSync('./caCert1.pem')/*, ... */];
  const verifier = new Verifier(trustedCerts);
  const mdoc = await verifier.verify(encodedDeviceResponse, {
    ephemeralReaderKey,
    encodedSessionTranscript,
  });

  inspect(mdoc);
})();
```

# Data Exchange

[^1]: @auth0/mdl https://www.npmjs.com/package/@auth0/mdl
[^2]: ISO/IEC 18013-5:2021 Personal identification â€” ISO-compliant driving licence Part 5: Mobile driving licence (mDL) application Authentication Method Reference Values https://www.iso.org/standard/69084.html
[^3]: ISO/IEC TS 18013-7:2024 Personal identification â€” ISO-compliant driving licence Part 7: Mobile driving licence (mDL) add-on functions https://www.iso.org/standard/82772.html
[^4]: Mobile Driver's License Implementation Guidelines, Version 1.3 https://www.aamva.org/assets/best-practices,-guides,-standards,-manuals,-whitepapers/mobile-driver-s-license-implementation-guidelines-1-2