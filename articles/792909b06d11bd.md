---
title: "[å‚™å¿˜éŒ²] @auth0/mdl ã§ mDL ã‚’ç†è§£ã™ã‚‹ãŸã‚ã®ãƒ¡ãƒ¢"
emoji: "ğŸªª"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["nodejs", "mdoc"]
published: true
---

# ã¯ã˜ã‚ã«

ã“ã®è¨˜äº‹ã¯ @auth0/mdl [^1] ã¨ã„ã† mDL (mobile Driver Licenses) ã®ç™ºè¡ŒãŠã‚ˆã³æ¤œè¨¼ãŒå¯èƒ½ãª Node.js ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å‹•ã‹ã—ãªãŒã‚‰ mDL ã®ä»•æ§˜ã«æƒ³ã„ã‚’é¦³ã›ãŸéš›ã®ãŸã ã®å€‹äººãƒ¡ãƒ¢ã§ã™ã€‚ãŸã ã®å€‹äººãƒ¡ãƒ¢ã§ã‚ã‚Šã€å†…å®¹ã®æ­£ç¢ºæ€§ã¯ä¿è¨¼ã•ã‚Œãšã€å®šæœŸçš„ã«å†…å®¹ã®æ›´æ–°ãŒè¡Œã‚ã‚Œã‚‹å¯èƒ½æ€§ãŒé«˜ã„ç‚¹ã«ç•™æ„ã—ã¦ãã ã•ã„ã€‚

@auth0/mdl[^1] ã¯ ISO/IEC 18013-5 [^2] ã‚„ ISO/IEC 18013-7 [^3]ã¨ã„ã£ãŸä»•æ§˜ã«åŸºã¥ã„ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚ç¾æ™‚ç‚¹ã«ãŠã„ã¦ã€å‰è¿°ã®ä»•æ§˜ã¯ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’è³¼å…¥ã—ãŸä¸Šã§èª­ã‚€å¿…è¦ãŒã‚ã‚‹ã®ãŸã‚ã€ç„¡æ–™ã§å…¬é–‹ã•ã‚Œã¦ãŠã‚Šè©³ã—ã„è§£èª¬ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹è¨˜äº‹ [^4] ãªã©ã‚’é©å®œå‚ç…§ã™ã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚

æœ¬è¨˜äº‹ã§ã¯ã€è«¸ã€…ã®æ•´ç†ã«ã‚ãŸã£ã¦ä»¥ä¸‹ã®æŠ½è±¡åŒ–ã—ãŸ mDL ecosystem ã®å›³ã‚’ã‚‚ã¨ã«ãŠã“ãªã„ã¾ã™ã€‚

![mDL interfaces](/images/792909b06d11bd/mDL_interfaces.png)

ãªãŠã€æœ¬è¨˜äº‹ã§ã¯ã€credential ã®ç™ºè¡ŒãŠã‚ˆã³æ¤œè¨¼ã«ã¤ã„ã¦æ•´ç†ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€ISO/IEC 18013-5 [^2] ã«ãŠã‘ã‚‹ Data Exchange ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¨ã—ã¦ Web API ã‚„ OID4VP ãŒã‚ã‚Šã¾ã™ãŒã€ã“ã‚Œã‚‰ã®è©³ç´°ã‚„é•ã„ã«ã¤ã„ã¦ã¯è§¦ã‚Œã¾ã›ã‚“ã€‚
ã‚ãã¾ã§ Data model ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã—ãŸä¸Šã§ã®æ•´ç†ã§ã‚ã‚Šã€credential ãŒã©ã®ã‚ˆã†ã« Issuing authority ã‚„ mDL holderã€mDL holder ã‚„ mDL verifier é–“ã§æ¸¡ã•ã‚Œã‚‹ã‹ã«ã¤ã„ã¦ã¯æœ¬è¨˜äº‹ã§ã¯ä¸€æ—¦å¯¾è±¡å¤–ã¨ã—ã¾ã™ã€‚

æœ¬è¨˜äº‹ã§è©¦ã—ãŸéš›ã®ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®ãƒªãƒã‚¸ãƒˆãƒªã«å‹•ä½œç¢ºèªå¯èƒ½ãªçŠ¶æ…‹ã§é…ç½®ã—ã¾ã™ã€‚

https://github.com/kg0r0/node-mdl-example

# Issuing authority <-> mDL holder

ã–ã£ãã‚Šã¨ã§ã™ãŒã€ISO/IEC 18013-5 ã«ãŠã‘ã‚‹ mdoc data model ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚**doctype** ãŒ ``org.iso.18013.5.1.mDL`` ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã€**namespace** ã«å„å±æ€§æƒ…å ±ãŒå«ã¾ã‚Œã¾ã™ã€‚
ã¾ãŸã€Issuing authority ã¯ç™ºè¡Œã™ã‚‹ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã«å¯¾ã—ã¦ç½²åã‚’ãŠã“ãªã„ã¾ã™ã€‚ã“ã®ã¨ãã®ãƒ‡ãƒ¼ã‚¿ã¯ IssuerAuth ã¨å‘¼ã°ã‚Œã€mobile security object (MSO) ã¨ã„ã†å½¢å¼ã®ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦æ‰±ã‚ã‚Œã¾ã™ã€‚@auth0/mdl ã«ãŠã„ã¦ã€[IssuerAuth ã®ç”Ÿæˆå‡¦ç†](https://github.com/auth0-lab/mdl/blob/334bb57ab348565f1674a65cb771205c6809d85f/src/mdoc/model/IssuerSignedDocument.ts#L9-L30)ã‚„ [MSO](https://github.com/auth0-lab/mdl/blob/334bb57ab348565f1674a65cb771205c6809d85f/src/mdoc/model/types.ts#L106-L120) ã®å‹å®šç¾©ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

![](/images/792909b06d11bd/mdoc_data_model.png)

@auth0/mdl[^1] ã‚’ä½¿ç”¨ã—ãŸ Issuing authority ã«ã‚ˆã‚‹ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã®ç™ºè¡Œã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãŠã“ãªã†ã“ã¨ãŒã§ãã¾ã™ã€‚å‰è¿°ã®é€šã‚Šã€[addIssuerNameSpace](https://github.com/auth0-lab/mdl/blob/334bb57ab348565f1674a65cb771205c6809d85f/src/mdoc/model/Document.ts#L61-L100) ãªã©ã§ **doctype** ã‚„ **namespace** ã‚’æŒ‡å®šã§ãã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚ã¾ãŸã€IssuerAuth ã®ãŸã‚ã®ç½²åéµã‚„è¨¼æ˜æ›¸ã€ãƒ‡ãƒã‚¤ã‚¹ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚­ãƒ¼ãªã©ã‚‚æŒ‡å®šã—ã¾ã™ã€‚

```js
import { MDoc, Document } from "@auth0/mdl";
import { inspect } from "node:util";

...

  {
    let issuerPrivateKey;
    let issuerCertificate;
    let devicePublicKey; // the public key for the device, as a JWK

    const document = await new Document('org.iso.18013.5.1.mDL')
      .addIssuerNameSpace('org.iso.18013.5.1', {
        family_name: 'Jones',
        given_name: 'Ava',
        birth_date: '2007-03-25',
      })
      .useDigestAlgorithm('SHA-256')
      .addValidityInfo({
        signed: new Date(),
      })
      .addDeviceKeyInfo({ deviceKey: devicePublicKey })
      .sign({
        issuerPrivateKey,
        issuerCertificate,
        alg: 'ES256',
      });

    issuerMDoc = new MDoc([document]).encode();
  }
```

ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã®å‡ºåŠ›ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚ã“ã“ã§ã¯ CBOR ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹ãªã®ã§è©³ç´°ã¯ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ãŸã†ãˆã§ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

**Output:**

```bash
[*] Issuing a credential:
<Buffer b9 00 03 67 76 65 72 73 69 6f 6e 63 31 2e 30 69 64 6f 63 75 6d 65 6e 74 73 81 a2 67 64 6f 63 54 79 70 65 75 6f 72 67 2e 69 73 6f 2e 31 38 30 31 33 2e ... 1755 more bytes>
```

ä»¥ä¸‹ãŒä¸Šè¨˜ã®å‡ºåŠ›ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ãŸçµæœã§ã™ã€‚namespace ã‚„ IssuerAuth ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

```js
[*] CBOR decoded credential:
[
  {
    version: '1.0',
    documents: [
      {
        docType: 'org.iso.18013.5.1.mDL',
        issuerSigned: { // Returned data elements signed by the issuer
          nameSpaces: { // Returned data elements
            'org.iso.18013.5.1': [
              Tagged {
                tag: 24,
                value: <Buffer a4 68 64 69 67 65 73 74 49 44 00 71 65 6c 65 6d 65 6e 74 49 64 65 6e 74 69 66 69 65 72 6b 66 61 6d 69 6c 79 5f 6e 61 6d 65 6c 65 6c 65 6d 65 6e 74 56 ... 51 more bytes>,
                err: undefined
              },
              Tagged {
                tag: 24,
                value: <Buffer a4 68 64 69 67 65 73 74 49 44 01 71 65 6c 65 6d 65 6e 74 49 64 65 6e 74 69 66 69 65 72 6a 67 69 76 65 6e 5f 6e 61 6d 65 6c 65 6c 65 6d 65 6e 74 56 61 ... 48 more bytes>,
                err: undefined
              },
              Tagged {
                tag: 24,
                value: <Buffer a4 68 64 69 67 65 73 74 49 44 02 71 65 6c 65 6d 65 6e 74 49 64 65 6e 74 69 66 69 65 72 6a 62 69 72 74 68 5f 64 61 74 65 6c 65 6c 65 6d 65 6e 74 56 61 ... 55 more bytes>,
                err: undefined
              },
              Tagged {
                tag: 24,
                value: <Buffer a4 68 64 69 67 65 73 74 49 44 03 71 65 6c 65 6d 65 6e 74 49 64 65 6e 74 69 66 69 65 72 6b 61 67 65 5f 6f 76 65 72 5f 32 31 6c 65 6c 65 6d 65 6e 74 56 ... 46 more bytes>,
                err: undefined
              },
              Tagged {
                tag: 24,
                value: <Buffer a4 68 64 69 67 65 73 74 49 44 04 71 65 6c 65 6d 65 6e 74 49 64 65 6e 74 69 66 69 65 72 6b 61 67 65 5f 6f 76 65 72 5f 31 37 6c 65 6c 65 6d 65 6e 74 56 ... 46 more bytes>,
                err: undefined
              }
            ]
          },
          issuerAuth: [ // Contains the mobile security object (MSO) for issuer data authentication
            <Buffer a1 01 26>,
            Map(2) {
              4 => <Buffer 31 32 33 34>,
              33 => [
                <Buffer 30 82 02 2a 30 82 01 d0 a0 03 02 01 02 02 14 57 c6 cc d3 08 bd e4 3e ca 37 44 f2 a8 71 38 da bb b8 84 e8 30 0a 06 08 2a 86 48 ce 3d 04 03 02 30 53 31 ... 508 more bytes>
              ]
            },
            <Buffer d8 18 59 02 04 b9 00 06 67 76 65 72 73 69 6f 6e 63 31 2e 30 6f 64 69 67 65 73 74 41 6c 67 6f 72 69 74 68 6d 67 53 48 41 2d 32 35 36 6c 76 61 6c 75 65 ... 471 more bytes>,
            <Buffer c8 ea f2 7b 60 15 b8 05 31 b7 0d 91 a3 71 4b b3 ef ba 0d ba 2f 1f 90 f2 05 88 a7 77 79 85 ac 17 34 6b 58 3a ae 92 5c c2 18 1c 13 b9 c6 0f cb 12 03 27 ... 14 more bytes>
          ]
        }
      }
    ],
    status: 0
  }
]
```

# mDL holder <-> mDL verifier

ã–ã£ãã‚Šã¨ã§ã™ãŒã€ã“ã“ã§ã¯ã€mDL verifier ãŒ mDL holder ã«å¯¾ã—ã¦æç¤ºã—ã¦æ¬²ã—ã„å±æ€§æƒ…å ±ãªã©ã‚’ä¼é”ã—ã€mDL holder ãŒ mDL verifier ã«è¿”ã™ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã—ã¦è¿”ã—ã¾ã™ã€‚ãªãŠã€å‰è¿°ã®é€šã‚Šã€mDL verifier ã¨ mDL holder é–“ã§ã©ã®ã‚ˆã†ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚„ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«ã‚ˆã£ã¦æç¤ºã™ã‚‹å±æ€§æƒ…å ±ãªã©ã‚’ä¼é”ã™ã‚‹ã‹ã«ã¤ã„ã¦ã¯ä¸€æ—¦æœ¬è¨˜äº‹ã«ãŠã„ã¦ã¯ã‚¹ã‚³ãƒ¼ãƒ—å¤–ã¨ã—ã¾ã™ã€‚å®Ÿéš›ã«ã¯ã€ä¾‹ãˆã° OpenID for Verifiable Presentations (OID4VP)[^5] ã‚„ã€ãã®ä¸­ã§ä½¿ã‚ã‚Œã¦ã„ã‚‹ DIF Presentation Exchange ã® Presentation Definition[^6] ã«åŸºã¥ã„ã¦ãŠã“ãªã‚ã‚ŒãŸã‚Šã—ã¾ã™ã€‚

ãƒ‡ãƒ¼ã‚¿å½¢å¼ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã—ãŸå ´åˆã€å…ˆã»ã© Issuing authority ã«ã‚ˆã£ã¦ç™ºè¡Œã•ã‚ŒãŸã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ãŠã‚ˆã³ã€mDL holder ã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚ŒãŸè¿½åŠ ã®ç½²åãƒ‡ãƒ¼ã‚¿ãƒ¼ã‚’ä»˜ä¸ã—ãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ mDL verifier ã«é€ä¿¡ã™ã‚‹ã¨ã„ã†ã®ãŒä¸»ãªå‡¦ç†ã«ãªã‚Šã¾ã™ã€‚ã“ã®ã¨ãã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯ DeviceResponse ã¨ ISO/IEC 18013-5[^2] ã§ã¯å®šç¾©ã•ã‚Œã¦ã„ã‚‹ (æ°—ãŒã—ã¾ã™)ã€‚@auth0/mdl[^1] ã«ãŠã„ã¦ã‚‚ [DeviceResponse](https://github.com/auth0-lab/mdl/blob/334bb57ab348565f1674a65cb771205c6809d85f/src/mdoc/model/DeviceResponse.ts#L18-L28) ã‚¯ãƒ©ã‚¹ã®å®Ÿè£…ã‹ã‚‰ã©ã†ã„ã£ãŸãƒ‡ãƒ¼ã‚¿ãŒå«ã¾ã‚Œã‚‹ã“ã¨ã«ãªã‚‹ã‹ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ãªãŠã€@auth0/mdl[^1] ã‚’ä½¿ç”¨ã—ãŸ mDL holder ã«ã‚ˆã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ç”Ÿæˆã¯ä»¥ä¸‹ã®é€šã‚Šè¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

```js
import { MDoc, Document } from "@auth0/mdl";
import { inspect } from "node:util";

...

  {
    let devicePrivateKey; // the private key for the device, as a JWK

    // Parameters coming from the OID4VP transaction
    let mdocGeneratedNonce, clientId, responseUri, verifierGeneratedNonce;
    let presentationDefinition = {
      id: 'family_name_only',
      input_descriptors: [
        {
          id: 'org.iso.18013.5.1.mDL',
          format: { mso_mdoc: { alg: ['EdDSA', 'ES256'] } },
          constraints: {
            limit_disclosure: 'required',
            fields: [{
                path: ["$['org.iso.18013.5.1']['family_name']"],
                intent_to_retain: false,
              }],
          },
        },
      ],
    };

    deviceResponseMDoc = await DeviceResponse.from(issuerMDoc)
      .usingPresentationDefinition(presentationDefinition)
      .usingSessionTranscriptForOID4VP(mdocGeneratedNonce, clientId, responseUri, verifierGeneratedNonce)
      .authenticateWithSignature(devicePrivateKey, 'ES256')
      .sign();
  }
```

ã“ã®æ™‚ç‚¹ã§æ–°ã—ãå‡ºã¦ããŸæ¦‚å¿µã¨ã—ã¦ã¯ Session Transcript ãŒã‚ã‚Šã¾ã™ã€‚ISO/IEC 18013-5[^2] ã«ãŠã„ã¦ã€Session Transcript ã¯ device retrieval ã®ãŸã‚ã®è¤‡æ•°ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã«ä½¿ã†ã“ã¨ãŒã§ãã‚‹ã¨ã•ã‚Œã€DeviceEngagementBytes, EReaderKeyBytes, Handover ã¨ã„ã£ãŸãƒ‡ãƒ¼ã‚¿ã‹ã‚‰æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ã€‚
ãªãŠã€ç¾æ™‚ç‚¹ã«ãŠã„ã¦è‡ªåˆ†ãŒç¢ºèªã™ã‚‹é™ã‚Šã€å…·ä½“çš„ã«ã©ã®å€¤ã‚’ä½¿ç”¨ã—ã¦ Session Transcript ã‚’ç”Ÿæˆã™ã‚‹ã¹ãã‹ã¯ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã‚’ä¼é”ã™ã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«ä¾å­˜ã—ã¦ç•°ãªã‚Šã¾ã™ã€‚ä¾‹ãˆã°ã€@auth0/mdl[^1] ã®[å®Ÿè£…](https://github.com/auth0-lab/mdl/blob/334bb57ab348565f1674a65cb771205c6809d85f/src/mdoc/model/DeviceResponse.ts#L107-L161)ã‚„ã€Digital Credentials API[^7] ã®ãƒ‡ãƒ¢ã¨ã—ã¦ã‚‚ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹[å®Ÿè£…](https://github.com/openwallet-foundation-labs/identity-credential/blob/b4ce259006c0a39235b47d4d26913eca5c12b0a3/identity-android/src/main/java/com/android/identity/android/mdoc/util/CredmanUtil.kt#L78-L90)ã‚’ã¿ã‚‹é™ã‚Šã§ã‚‚ç•°ãªã‚‹ Session Transcript ã®ç”Ÿæˆå‡¦ç†ãŒç¢ºèªã§ãã¾ã™ (OID4VP ã«é–¢ã—ã¦ã„ãˆã° ISO/IEC 18013-7[^3] ã® Annex B ã‚ãŸã‚Šã«ç´°ã‹ã„ã“ã¨ãŒæ›¸ã‹ã‚Œã¦ã„ã¾ã—ãŸã€‚)ã€‚

ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã®å‡ºåŠ›ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚ISO/IEC 18013-5[^2] ã«ãŠã‘ã‚‹ DeviceResponse ã® documents ã®ä¸­èº«ã«ã¤ã„ã¦ã¯ã€[DeviceSignedDocument](https://github.com/auth0-lab/mdl/blob/334bb57ab348565f1674a65cb771205c6809d85f/src/mdoc/model/DeviceSignedDocument.ts#L11-L42)ã‚¯ãƒ©ã‚¹ã¨ã—ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã€[IssuerSigned](https://github.com/auth0-lab/mdl/blob/main/src/mdoc/model/types.ts#L24-L27) ãŠã‚ˆã³ [DeviceSigned](https://github.com/auth0-lab/mdl/blob/334bb57ab348565f1674a65cb771205c6809d85f/src/mdoc/model/types.ts#L33-L36) ã‚’å«ã‚“ã§ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

**Output:**

```js
MDoc {
  documents: [
    DeviceSignedDocument {
      docType: 'org.iso.18013.5.1.mDL', // Document type returned
      issuerSigned: [Object],           // Returned data elements signed by the issuer
      deviceSigned: [Object]            // Returned data elements signed by the mdoc
    }
  ],
  version: '1.0',
  status: 0,
  documentErrors: []
}
```


# mDL verifier <-> Issuing authority

æœ€å¾Œã« mDL verifier ã¯ mDL holder ã‹ã‚‰å—ã‘å–ã£ãŸ DeviceResponse ã‚’æ¤œè¨¼ã—ã¾ã™ã€‚
[verify()](https://github.com/auth0-lab/mdl/blob/0160c1da74d4ff2a315aec316241b948b2a1951e/src/mdoc/Verifier.ts#L305-L350) ã®ä¸­ã§ã¯ã€ä¸»ã« [verifyIssuerSignature()](https://github.com/auth0-lab/mdl/blob/0160c1da74d4ff2a315aec316241b948b2a1951e/src/mdoc/Verifier.ts#L39-L93) ãŠã‚ˆã³ [verifyDeviceSignature()](https://github.com/auth0-lab/mdl/blob/0160c1da74d4ff2a315aec316241b948b2a1951e/src/mdoc/Verifier.ts#L95-L220) ãŒå‘¼ã³å‡ºã•ã‚Œã¾ã™ã€‚
Issuer Signature ã‚’æ¤œè¨¼ã™ã‚‹ã“ã¨ã§ã€mdoc ãŒæ„å›³ã—ãŸ Issuer ã‹ã‚‰ç™ºè¡Œã•ã‚ŒãŸã‚‚ã®ã§ã‚ã‚‹ã“ã¨ã‚’æ¤œè¨¼ã§ãã¾ã™ã€‚ã¾ãŸã€Device Signature ã‚’æ¤œè¨¼ã™ã‚‹ã“ã¨ã§ mdoc ãŒæ„å›³ã—ãŸ Holder ã‹ã‚‰ç™ºè¡Œã•ã‚ŒãŸã‚‚ã®ã§ã‚ã‚‹ã“ã¨ã‚’æ¤œè¨¼ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ (Verifiable Credentials Data Model ã«ãŠã„ã¦ã€Verifiable Credential ã® Proof ãŠã‚ˆã³ã€Verifiable Presentation ã® Proof ã‚’æ¤œè¨¼ã™ã‚‹ã®ã¨ä¼¼ãŸã‚ˆã†ãªæ„Ÿã˜ã ã¨æ€ã£ã¦ã„ã¾ã™)ã€‚

```js
import { Verifier } from "@auth0/mdl";
import { inspect } from "node:util";
import fs from "node:fs";

(async () => {
  const encodedDeviceResponse = Buffer.from(encodedDeviceResponseHex, 'hex');
  const encodedSessionTranscript = Buffer.from(encodedSessionTranscriptHex, 'hex');
  const ephemeralReaderKey = Buffer.from(ephemeralReaderKeyHex, 'hex');

  const trustedCerts = [fs.readFileSync('./caCert1.pem')/*, ... */];
  const verifier = new Verifier(trustedCerts);
  const mdoc = await verifier.verify(encodedDeviceResponse, {
    ephemeralReaderKey,
    encodedSessionTranscript,
  });

  //at this point the issuer and device signature are valids.
  inspect(mdoc);
})();
```

æ¤œè¨¼ãŒæˆåŠŸã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªçµæœã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚Presentation Definition ã§æŒ‡å®šã—ãŸå±æ€§æƒ…å ±ãªã©ãŒå–å¾—ã§ãã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚ã€€

**Output:**

```js
[*] Verifying a credential:
MDoc {
  documents: [
    DeviceSignedDocument {
      docType: 'org.iso.18013.5.1.mDL',
      issuerSigned: [Object],
      deviceSigned: [Object]
    }
  ],
  version: '1.0',
  status: 0,
  documentErrors: []
}
[*] Getting diagnostic information:
{
  general: { version: '1.0', type: 'DeviceResponse', status: 0, documents: 1 },
  validityInfo: {
    signed: 2024-11-16T09:58:53.000Z,
    validFrom: 2024-11-16T09:58:53.000Z,
    validUntil: 2025-11-16T09:58:53.000Z,
    expectedUpdate: undefined
  },
  issuerCertificate: {
    subjectName: 'C=US, ST=New York, L=Albany, O=NY DMV, OU=NY DMV',
    pem: '-----BEGIN CERTIFICATE-----\n' +
      'MIICKjCCAdCgAwIBAgIUV8bM0wi95D7KN0TyqHE42ru4hOgwCgYIKoZIzj0EAwIw\n' +
      'UzELMAkGA1UEBhMCVVMxETAPBgNVBAgMCE5ldyBZb3JrMQ8wDQYDVQQHDAZBbGJh\n' +
      'bnkxDzANBgNVBAoMBk5ZIERNVjEPMA0GA1UECwwGTlkgRE1WMB4XDTIzMDkxNDE0\n' +
      'NTUxOFoXDTMzMDkxMTE0NTUxOFowUzELMAkGA1UEBhMCVVMxETAPBgNVBAgMCE5l\n' +
      'dyBZb3JrMQ8wDQYDVQQHDAZBbGJhbnkxDzANBgNVBAoMBk5ZIERNVjEPMA0GA1UE\n' +
      'CwwGTlkgRE1WMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEiTwtg0eQbcbNabf2\n' +
      'Nq9L/VM/lhhPCq2s0Qgw2kRx29tgrBcNHPxTT64tnc1Ij3dH/fl42SXqMenpCDw4\n' +
      'K6ntU6OBgTB/MB0GA1UdDgQWBBSrbS4DuR1JIkAzj7zK3v2TM+r2xzAfBgNVHSME\n' +
      'GDAWgBSrbS4DuR1JIkAzj7zK3v2TM+r2xzAPBgNVHRMBAf8EBTADAQH/MCwGCWCG\n' +
      'SAGG+EIBDQQfFh1PcGVuU1NMIEdlbmVyYXRlZCBDZXJ0aWZpY2F0ZTAKBggqhkjO\n' +
      'PQQDAgNIADBFAiAJ/Qyrl7A+ePZOdNfc7ohmjEdqCvxaos6//gfTvncuqQIhANo4\n' +
      'q8mKCA9J8k/+zh//yKbN1bLAtdqPx7dnrDqV3Lg+\n' +
      '-----END CERTIFICATE-----',
    notBefore: 2023-09-14T14:55:18.000Z,
    notAfter: 2033-09-11T14:55:18.000Z,
    serialNumber: '57c6ccd308bde43eca3744f2a87138dabbb884e8',
    thumbprint: '77cc9f091ee425664ce71735670c56e7260a6f3b'
  },
  issuerSignature: {
    alg: 'ES256',
    isValid: true,
    reasons: [],
    digests: { 'org.iso.18013.5.1': 5 }
  },
  deviceKey: {
    jwk: {
      kty: 'EC',
      x: 'iBh5ynojixm_D0wfjADpouGbp6b3Pq6SuFHU3htQhVk',
      y: 'oxS1OAORJ7XNUHNfVFGeM8E0RQVFxWA62fJj-sxW03c',
      crv: 'P-256',
      d: 'eRpAZr3eV5xMMnPG3kWjg90Y-bBff9LqmlQuk49HUtA'
    }
  },
  deviceSignature: { alg: 'ES256', isValid: true, reasons: [] },
  dataIntegrity: { disclosedAttributes: '1 of 5', isValid: true, reasons: [] },
  attributes: [
    {
      ns: 'org.iso.18013.5.1',
      id: 'family_name',
      value: 'Jones',
      isValid: true,
      matchCertificate: undefined
    }
  ],
  deviceAttributes: []
}
```

# ãŠã‚ã‚Šã«

æ”¹ã‚ã¦è¨˜è¼‰ã—ã¾ã™ãŒã€ã“ã‚Œã¯ãŸã ã®ãƒ¡ãƒ¢ã§ã™ã€‚mDL ã§ã¯ä»–ã®ä»•æ§˜ã«ã¯å‡ºã¦ã“ãªã„ç”¨èªãªã©ã‚‚ã‚ã‚Šã€å‡¦ç†ã®æµã‚Œã‚„è©³ç´°ã‚’å¿˜ã‚ŒãŒã¡ãªã®ã§æ—¢å­˜ã®å®Ÿè£…ã‚’è§¦ã‚ŠãªãŒã‚‰è‰²ã€…ã¨ãƒ¡ãƒ¢ã¨ã—ã¦æ®‹ã—ã¿ã¾ã—ãŸã€‚
é€”ä¸­ã§åŠ›å°½ãã¦ä¸€éƒ¨èª¬æ˜ãŒé›‘ã«ãªã£ãŸã‚Šã—ã¦ã„ã‚‹éƒ¨åˆ†ãŒã‚ã‚‹ã®ã§æ°—ãŒå‘ã„ãŸã‚‰ç¶™ç¶šçš„ã«å†…å®¹ã‚’æ›´æ–°ã™ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚æœªæ¥ã®è‡ªåˆ†ã®ä½•ã‹ã—ã‚‰ã®å½¹ã«ç«‹ã¦ã°å¹¸ã„ã§ã™ã€‚

[^1]: @auth0/mdl https://www.npmjs.com/package/@auth0/mdl
[^2]: ISO/IEC 18013-5:2021 Personal identification â€” ISO-compliant driving licence Part 5: Mobile driving licence (mDL) application Authentication Method Reference Values https://www.iso.org/standard/69084.html
[^3]: ISO/IEC TS 18013-7:2024 Personal identification â€” ISO-compliant driving licence Part 7: Mobile driving licence (mDL) add-on functions https://www.iso.org/standard/82772.html
[^4]: Mobile Driver's License Implementation Guidelines, Version 1.3 https://www.aamva.org/assets/best-practices,-guides,-standards,-manuals,-whitepapers/mobile-driver-s-license-implementation-guidelines-1-2
[^5]: OpenID for Verifiable Presentations - https://openid.net/specs/openid-4-verifiable-presentations-1_0.html
[^6]: DIF Presentation Exchange https://identity.foundation/presentation-exchange/#presentation-definition
[^7]: Introducing the Digital Credentials API origin trial https://developer.chrome.com/blog/digital-credentials-api-origin-trial
[^8]: Digital Credentials Demo https://digital-credentials.dev/
[^9]: Identity Credential https://github.com/openwallet-foundation-labs/identity-credential
