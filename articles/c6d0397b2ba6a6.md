---
title: "Okta ã® DPoP ã‚’ãŸã‚ã—ã¦ã¿ãŸ"
emoji: "ğŸ‘»"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["okta", "OAuth"]
published: true
---

Digital Identity æŠ€è¡“å‹‰å¼·ä¼š #iddance Advent Calendar 2023 ã‚·ãƒªãƒ¼ã‚º 2 ã®è¨˜äº‹ã§ã™ã€‚

https://qiita.com/advent-calendar/2023/iddance

## ã¯ã˜ã‚ã«

2023 å¹´ã« Okta ãŒ DPoP[^1] ã®ã‚µãƒãƒ¼ãƒˆã‚’ç™ºè¡¨ã—ã¦ã„ã¾ã—ãŸã€‚ä»Šå›ã¯ã“ã‚Œã‚’è©¦ã—ã¦ã¿ã¦æ‰‹é †ãªã©ã‚’å‚™å¿˜éŒ²ã¨ã—ã¦æ®‹ã—ã¾ã™ã€‚

https://www.okta.com/blog/2023/06/a-leap-forward-in-token-security-okta-adds-support-for-dpop/

ãªãŠã€æœ¬æŠ•ç¨¿ã¯ã‚ãã¾ã§å‚™å¿˜éŒ²ã§ã‚ã‚Šã€æ­£å¼ãªæ‰‹é †ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã® Okta ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰ç¢ºèªã™ã‚‹ã‚ˆã†ã«ãŠé¡˜ã„ã—ã¾ã™ã€‚

https://developer.okta.com/docs/guides/dpop/main/


## å‹•ä½œç¢ºèª

### Okta è¨­å®š

ã¾ãšã¯ Okta ã« OpenID Connect (OIDC) ã® Native Application ã‚’ä½œæˆã—ã¾ã™ã€‚

![](/images/c6d0397b2ba6a6/Configure_DPoP_1.png)

ã“ã®ã¨ãã€``Require Demonstrating Proof of Possession (DPoP) header in token requests``ã¨ã„ã†è¨­å®šã‚’æœ‰åŠ¹ã«ã—ã¾ã™ã€‚

![](/images/c6d0397b2ba6a6/Configure_DPoP_3.png)

ã¾ãŸã€å‹•ä½œç¢ºèªã®ãŸã‚ã« ``redirect URIs`` ã‚„ ``Grant type`` ã®è¨­å®šã‚’ç¢ºèªã—ã¦ãŠãã¾ã™ã€‚

![](/images/c6d0397b2ba6a6/Configure_DPoP_2.png)

ã¡ãªã¿ã«ã€Authorization Server Metadata (``https://<Okta domain>/oauth2/default/.well-known/openid-configuration``) ã‹ã‚‰ ``"dpop_signing_alg_values_supported":["RS256","RS384","RS512","ES256","ES384","ES512"]`` ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚


### JSON Web Key (JWK) ãŠã‚ˆã³ JSON Web Token (JWT) ã®ä½œæˆ

ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å«ã‚ã‚‹ DPoP proof JWT ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã®æº–å‚™ã‚’è¡Œã„ã¾ã™ã€‚

ã¾ãšã¯ç½²åãŠã‚ˆã³æ¤œè¨¼ã«ä½¿ç”¨ã™ã‚‹ JWK ã‚’ç”¨æ„ã—ã¾ã™ã€‚ä»Šå›ã¯ã‚ãã¾ã§å‹•ä½œç¢ºèªã®ç”¨é€”ãªã®ã§ JSON Web Key generator[^2] ã¨ã„ã†ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ç”¨ã—ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«ä½œæˆã—ã¾ã™ã€‚

![](/images/c6d0397b2ba6a6/Create_a_JSON_Web_Key.png)

æ¬¡ã« DPoP proof JWT ã‚’ä½œæˆã™ã‚‹æº–å‚™ã‚’è¡Œã„ã¾ã™ã€‚ã“ã¡ã‚‰ã‚‚ã‚ãã¾ã§å‹•ä½œç¢ºèªã®ç”¨é€”ãªã®ã§ JWT.IO[^3] ã¨ã„ã†ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

DPoP proof JWT ã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã®è©³ç´°ã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ã®é€šã‚Š RFC 9449[^1] ã‹ã‚‰ã‚‚ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

>  4.2. DPoP Proof JWT Syntax 
>  A DPoP proof is a JWT [RFC7519] that is signed (using JSON Web Signature (JWS) [RFC7515]) with a private key chosen by the client (see below). The JOSE Header of a DPoP JWT MUST contain at least the following parameters:
> (å¼•ç”¨å…ƒ: https://datatracker.ietf.org/doc/html/rfc9449#section-4.2)

å…ˆã»ã©ä½œæˆã—ãŸ JWK ã® Public Key ã‚’ Header ã«æŒ‡å®šã—ã¾ã™ã€‚

![](/images/c6d0397b2ba6a6/Create_the_JSON_Web_Token_1.png)

ã¾ãŸã€X.509 PEM Format ã® Private Key ãŠã‚ˆã³ Public Key ã‚’è¨­å®šã—ã¦ ``Signature Verified`` ã¨ã„ã†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

### ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

å®Ÿéš›ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ã¦ã¿ã¾ã™ã€‚

ã¾ãšã¯ Token Endpoint ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹ãŸã‚ã« Authorization Code ã‚’å–å¾—ã—ã¦ãŠãã¾ã™ã€‚ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå½¢å¼ã® URL ã‹ã‚‰ãƒ•ãƒ­ãƒ¼ã‚’é–‹å§‹ã—ã¦ Authorization Code ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãªãŠã€PKCE ã«é–¢ã™ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã«ã¤ã„ã¯ RFC 7636[^4] ã«ã‚µãƒ³ãƒ—ãƒ«ã¨ã—ã¦è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹å€¤ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚å®Ÿéš›ã«ã¯ code_verifier ã¨ã—ã¦æ¨æ¸¬ä¸å¯èƒ½ãªå€¤ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚

```bash
https://<Okta domain>/oauth2/default/v1/authorize?response_type=code&client_id=<Client ID>&redirect_uri=https://localhost:8443/cb&scope=openid offline_access&state=abc&code_challenge=E9Melhoa2OwvFrEMTJguCHaoeK1t8URWbuGJSstw-cM&code_challenge_method=s256
```

æ¬¡ã«ã“ã“ã¾ã§ç”¨æ„ã—ãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ãªã©ã‚’ä½¿ç”¨ã—ã¦ Token Endpoint ã«å¯¾ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¡Œã„ã¾ã™ã€‚
ãªãŠã€DPoP proof JWT ã® iat ã‚¯ãƒ¬ãƒ¼ãƒ ãŒå¤ããªã£ã¦ã„ã‚‹å ´åˆã€``{"error":"invalid_dpop_proof","error_description":"The DPoP proof JWT is issued more than five minutes in the past."}`` ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãŒè¿”ã•ã‚Œã‚‹ãŸã‚ã€é©å®œç¾åœ¨ã® Unix time ã‚’ç¢ºèªã—ã¦ DPoP proof JWT ã‚’æ›´æ–°ã—ã¾ã™ã€‚ 

```bash
$ date +%s
1704201397
```

ã“ã“ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã« ``Authorization server requires nonce in DPoP proof`` ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãŒè¿”ã•ã‚Œã€dpop-nonce ã¨ã„ã†ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã« nonce ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚ã“ã‚Œã¯ã€RFC 9449 - 8. Authorization Server-Provided Nonce[^1] ã®å‹•ä½œã£ã½ã„ã§ã™ã€‚

```bash
$ curl -i --request POST \
       --url 'https://<Okta domain>/oauth2/default/v1/token' \
       --header 'Accept: application/json' \
       --header 'DPoP: eyJ0eXAiOi.....J3_HkZhijxzWGqL9fPjGRng' \
       --header 'Content-Type: application/x-www-form-urlencoded' \
       --data 'grant_type=authorization_code' \
       --data 'redirect_uri=https://localhost:8443/cb' \
       --data 'code=<Authorization Code>' \
       --data 'code_verifier=dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk' \
       --data 'client_id=<Client ID>'
HTTP/1.1 400 Bad Request
Date: Tue, 02 Jan 2024 14:28:36 GMT
Content-Type: application/json
Transfer-Encoding: chunked
Connection: keep-alive
Server: nginx
...
dpop-nonce: yZrt0Q0sVAWm6DwghmxVQglPhxNBlt6A
x-content-type-options: nosniff
Strict-Transport-Security: max-age=315360000; includeSubDomains

{"error":"use_dpop_nonce","error_description":"Authorization server requires nonce in DPoP proof."}
```
ç¢ºèªã—ãŸ dpop-nonce ã‚’ä½¿ç”¨ã—ã¦å†åº¦ DPoP proof JWT ã‚’ç”Ÿæˆã—ã¾ã™ã€‚
![](/images/c6d0397b2ba6a6/Create_the_JSON_Web_Token_3.png)

å†åº¦ Token Endpoint ã«å¯¾ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¡Œã†ã“ã¨ã§å„ç¨®ãƒˆãƒ¼ã‚¯ãƒ³ãŒå–å¾—ã§ãã¾ã™ã€‚

```bash
$ curl -i --request POST \
     --url 'https://<Okta domain>/oauth2/default/v1/token' \
     --header 'Accept: application/json' \
     --header 'DPoP: eyJ0eXA.....ixVrkQkHHqQA' \
     --header 'Content-Type: application/x-www-form-urlencoded' \
     --data 'grant_type=authorization_code' \
     --data 'redirect_uri=https://localhost:8443/cb' \
     --data 'code=<Authorization Code>' \
     --data 'code_verifier=dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk' \
     --data 'client_id=<Client ID>'
HTTP/1.1 200 OK
Date: Tue, 02 Jan 2024 14:32:25 GMT
Content-Type: application/json
Transfer-Encoding: chunked
Connection: keep-alive
Server: nginx
...
dpop-nonce: yZrt0Q0sVAWm6DwghmxVQglPhxNBlt6A
x-content-type-options: nosniff
Strict-Transport-Security: max-age=315360000; includeSubDomains
X-Robots-Tag: noindex,nofollow

{"token_type":"DPoP","expires_in":3600,"access_token":"eyJraWQi.....QGvYLo1kbg","scope":"offline_access openid","refresh_token":"pGQ.....YBw","id_token":"eyJraWQiOiJ4....pujLlvsN8zm5KZxjblZA"}
```

ç™ºè¡Œã•ã‚ŒãŸ Access Token ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ãŸã¨ã“ã‚ cnf ã‚¯ãƒ¬ãƒ¼ãƒ ãŠã‚ˆã³ jkt ã‚¯ãƒ¬ãƒ¼ãƒ ãŒå­˜åœ¨ã—ã¦ãŠã‚Šã€å€¤ãŒ ``Zj5f3MI-u0bUAWfSq857CcwIJFp0j9h7PQ_zcg0fOig`` ã§ã‚ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚jkt ã‚¯ãƒ¬ãƒ¼ãƒ ã«ã¤ã„ã¦ã¯ RFC 9449 -  6.1. JWK Thumbprint Confirmation Method[^1] ãªã©ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

![](/images/c6d0397b2ba6a6/Access_Token.png)

ã¾ãŸã€jkt ã‚¯ãƒ¬ãƒ¼ãƒ ãŒäº‹å‰ã«ç”Ÿæˆã—ãŸ Public Key ã® SHA-256 thumbprint ã¨ä¸€è‡´ã—ã€Access Token ã¨ Public Key ã®ç´ä»˜ã‘ãŒç¢ºèªã§ãã¾ã—ãŸã€‚

```bash
$ cat rsa.jwk
{
    "kty": "RSA",
    "e": "AQAB",
    "use": "sig",
    "kid": "A4RhBfBByv6bgVlURGJqozj5gPDhl-USWH-FB1bXBCA",
    "alg": "RS256",
    "n": "iJfCBYV2RooFd1lgg4en1OD3FFc3l6_yTXkCDC7eB3t1SG-qM1Ne1JQScBHZQECB6yhRVrjj_vcTtKKGqAlsUlGn8UhOlXEIrfIiUQqaAkXXSpIAU_QTqcD9qFAC_pzeBeFswP8-7RQETBsUaxII6oFXS-D1qVEoYuFKaOD7m-VEABQGrEsIet1Y907oOdlXM-6BwgzaVXdQrWtwXpPSJ40swTPYwGxjnb813MeA3liV8WA5MaHtr4Fqsj3cBmIMmPfkj1bggbK73xWTJvx_Yrxa4B9SnfWBgNCt6hUqgBYQ2A3zDGyEUSBbNzrJWCVNR711dqeDLthg2cuPBlgPsQ"
}

$ jose jwk thp -i rsa.jwk -a S256
Zj5f3MI-u0bUAWfSq857CcwIJFp0j9h7PQ_zcg0fOig
```

Resource Server ã«ã‚ˆã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ãŠã‚ˆã³ DPoP HTTP Header ã®æ¤œè¨¼æ‰‹é †ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã¨ãŠã‚Š Okta ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰ç¢ºèªã§ãã¾ã™ã€‚
Resource Server ã¯ä¸‹è¨˜ã®ã™ã¹ã¦ã®æ¤œè¨¼æ‰‹é †ã‚’ãŠã“ãªã£ãŸã†ãˆã§ãƒªã‚½ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ã¾ã™ã€‚

> The following is a high-level overview of the validation steps that the resource server must perform.
>
> Note: The resource server must not grant access to the resource unless all checks are successful.
> 
> 1. Read the value in the DPoP header and decode the DPoP JWT.
> 2. Get the jwk (public key) from the header portion of the DPoP JWT.
> 3. Verify the signature of the DPoP JWT using the public key and algorithm in the JWT header.
> 4. Verify that the htu and htm claims are in the DPoP JWT payload and match with the current API request HTTP method and URL.
> 5. Calculate the jkt (SHA-256 thumbprint of the public key).
> 6. Extract the DPoP-bound access token from the Authorization header, verify it with Okta, and extract the claims. You can also use the /introspect endpoint to extract the access token claims.
> 7. Validate the token binding by comparing jkt from the access token with the calculated jkt from the DPoP header.
>
> (å¼•ç”¨å…ƒ: https://developer.okta.com/docs/guides/dpop/main/#validate-token-and-dpop-header)

Refresh Token ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã«ã¤ã„ã¦ã‚‚è©¦ã—ã¦ã¿ã¾ã™ã€‚
RFC 9449 ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã¨ãŠã‚Šã€Authorization Server ãŒ DPoP ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ãŠã‚Š Public Client ã«å¯¾ã—ã¦ Refresh Token ã‚’ç™ºè¡Œã—ãŸå ´åˆã€Refresh Token ã¨å…¬é–‹éµã®ç´ä»˜ã‘ã‚’ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

> When an authorization server supporting DPoP issues a refresh token to a public client that presents a valid DPoP proof at the token endpoint, the refresh token MUST be bound to the respective public key.
> (å¼•ç”¨å…ƒ: https://datatracker.ietf.org/doc/html/rfc9449#section-5)

ã¾ãšã¯ DPoP HTTP Header ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ Refresh Token ãŒä½¿ç”¨ã§ãã‚‹ã“ã¨ãŒç¢ºèªã—ã¾ã™ã€‚

```bash
$ curl --request POST \
     --url 'https://<Okta domain>/oauth2/default/v1/token' \
     --header 'Accept: application/json' \
     --header 'DPoP: eyJ0e6fq.....FlJcxQ' \
     --header 'Content-Type: application/x-www-form-urlencoded' \
     --data 'grant_type=refresh_token' \
     --data 'redirect_uri=https://localhost:8443/cb' \
     --data 'client_id=<Client ID>' \
     --data 'scope=offline_access openid' \
     --data 'refresh_token=pGQ.....YBw'
{"token_type":"DPoP","expires_in":3600,"access_token":"eyJraWQiOiJ4ZG.....F0XV9NP50X-hB-Zeg","scope":"offline_access openid","refresh_token":"pGQ.....YBw","id_token":"eyJraWQiOi.....vadmg5dgr3a"}
```

æ¬¡ã«ã€å†åº¦ JSON Web Key generator[^2] ã§ã‚­ãƒ¼ãƒšã‚¢ã‚’ä½œæˆã—ã€ãã®ã‚­ãƒ¼ãƒšã‚¢ã‚’ä½¿ç”¨ã—ã¦ç”Ÿæˆã—ãŸ DPoP proof JWT ã‚’ DPoP HTTP Header ã«æŒ‡å®šã—ã¦ã¿ã¾ã™ã€‚

```bash
$ curl --request POST \
       --url 'https://<Okta domain>/oauth2/default/v1/token' \
       --header 'Accept: application/json' \
       --header 'DPoP: eyJ0eX.....AiORIUEuOz6quBApKRfSPA' \
       --header 'Content-Type: application/x-www-form-urlencoded' \
       --data 'grant_type=refresh_token' \
       --data 'redirect_uri=https://localhost:8443/cb' \
       --data 'client_id=<Client ID>' \
       --data 'scope=offline_access openid' \
       --data 'refresh_token=pGQ.....YBw''
{"error":"invalid_dpop_proof","error_description":"The DPoP proof JWT signature is invalid."}
```

ä¸Šè¨˜ã®ã¨ãŠã‚Šã€ç½²åã®æ¤œè¨¼ã«å¤±æ•—ã—ã¦ãƒˆãƒ¼ã‚¯ãƒ³ãŒæ›´æ–°ã•ã‚Œãªã„ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚

## ãŠã‚ã‚Šã«

æœ¬æŠ•ç¨¿ã§ã¯ Okta ã® DPoP å®Ÿè£…ã‚’è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚
ä»¥ä¸‹ã®é€šã‚Š DPoP ã¯ Public Client ã§ sender-constrained token ã‚’æ‰±ã†å ´åˆã«ä½¿ç”¨ã§ãã‚‹æ–¹æ³•ã¨ã—ã¦ OAuth 2.0 Security Best Current Practice[^5] ãªã©ã§ã‚‚ç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ã€‚
ä¸€æ–¹ã§ã€Authorization Serverã€Clientã€Resource Server ã¨ã„ã£ãŸå„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã®å¯¾å¿œãŒå¿…è¦ã§ã‚ã‚Šã€ã“ã‚Œã‚‰ã®ã„ãšã‚Œã‹ã®å¯¾å¿œçŠ¶æ³ãŒæ¡ç”¨ã‚’é›£ã—ãã™ã‚‹è¦å› ã®ä¸€ã¤ã¨ã„ã†å°è±¡ãŒã‚ã‚Šã¾ã—ãŸã€‚ã“ã®ãŸã‚ã€ã“ã®ã‚ˆã†ã« DPoP ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ Authorization Server ãŒå¢—ãˆã¦ã„ãã“ã¨ã§ DPoP ã‚’æ¡ç”¨ã™ã‚‹ Client ã‚‚å¢—ãˆã¦ã„ãã‚­ãƒƒã‚«ã‚±ã«ã‚‚ãªã‚‹ã®ã§ã¯ãªã„ã‹ã¨æ€ã£ã¦ã„ã¾ã™ã€‚

> OAuth 2.0 Demonstrating Proof of Possession (DPoP) ([RFC9449]): DPoP outlines an application-level sender-constraining for access and refresh tokens that can be used in cases where neither mTLS nor OAuth Token Binding (see below) are available. It uses proof-of-possession based on a public/private key pair and application-level signing. DPoP can be used with public clients and, in case of confidential clients, can be combined with any client authentication method.
>
> (å¼•ç”¨å…ƒ: https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics#section-4.10.1)

ãã‚Œã¯ãã†ã¨ã€Public Client ã§ã©ã®ã‚ˆã†ã«ã—ã¦ Private Key ã‚’å®‰å…¨ã«ä¿å­˜ã™ã‚‹ã®ã‹ã¨ã„ã†ç‚¹ã«ã¤ã„ã¦ã¯ã©ã®ã‚ˆã†ãªæ•´ç†ã«ãªã£ã¦ã„ã‚‹ã®ã§ã—ã‚‡ã†ã‹ã€‚ä¾‹ãˆã° RFC 9449[^1] ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªè¨˜è¼‰ãŒã‚ã‚Šã¾ã™ãŒã€å…·ä½“çš„ã«ã¯ã©ã†ã„ã£ãŸä¿å­˜é ˜åŸŸãŒä½¿ç”¨ã•ã‚Œã‚‹ã®ã‹æ§˜ã€…ãªäº‹ä¾‹ãŒå‡ºã¦ãã‚‹ã“ã¨ã‚’å€‹äººçš„ã«æœŸå¾…ã‚’ã—ã¦ã„ãŸã‚Šã—ã¾ã™ã€‚

> If the private key is non-extractable (as is possible with [W3C.WebCryptoAPI]), DPoP renders exfiltrated tokens alone unusable.
> (å¼•ç”¨å…ƒ: https://datatracker.ietf.org/doc/html/rfc9449#section-2)

> If the private key used for DPoP is stored in such a way that it cannot be exported, e.g., in a hardware or software security module, the adversary cannot exfiltrate the key and use it to create arbitrary DPoP proofs.
> (å¼•ç”¨å…ƒ: https://datatracker.ietf.org/doc/html/rfc9449#name-untrusted-code-in-the-clien)

ã§ã¯ã¾ãŸï¼

[^1]: OAuth 2.0 Demonstrating Proof of Possession (DPoP) https://datatracker.ietf.org/doc/html/rfc9449
[^2]: mkjwk simple JSON Web Key generator https://mkjwk.org/
[^3]: JWT.IO generator https://jwt.io/
[^4]: Proof Key for Code Exchange by OAuth Public Clients https://datatracker.ietf.org/doc/html/rfc7636#appendix-B
[^5]: OAuth 2.0 Security Best Current Practice https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics