---
title: "OAuth2.1ã®å·®åˆ†ã‚’è¦‹å®ˆã‚‹ä¼š: draft 09-10"
emoji: "ğŸ•™"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["OAuth", "ietf", "rfc"]
published: false
---
æœ¬æŠ•ç¨¿ã¯ OAuth 2.1 ã£ã¦å‘¼ã°ã‚ŒãŸã„æ„Ÿã‚’å‡ºã—ã¦ã‚‹ä»•æ§˜ã®å·®åˆ†ã‚’è¦‹å®ˆã‚‹ä¼šã§ã™ã€‚

æœ¬æŠ•ç¨¿å«ã‚ã€å·®åˆ†ã‚’ ã‚¹ã‚¯ãƒ©ãƒƒãƒ— - [OAuth 2.1ã‚’è¦‹å®ˆã‚‹ä¼š](https://zenn.dev/ritou/scraps/098107802f952b) ã§ã¾ã¨ã‚ã¦ã„ã¾ã™ã€‚

## å·®åˆ†

[å·®åˆ†](https://author-tools.ietf.org/iddiff?url1=draft-ietf-oauth-v2-1-09&url2=draft-ietf-oauth-v2-1-10&difftype=--html)

[draft10](https://www.ietf.org/archive/id/draft-ietf-oauth-v2-1-10.html) ã«ãŠã‘ã‚‹ä¸»ãªå·®åˆ†ã¯ã€[Appendix E. Document History](https://www.ietf.org/archive/id/draft-ietf-oauth-v2-1-10.html#name-document-history) ã«è¨˜è¼‰ã®ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

ä¸€è¦‹å¤‰æ›´ç‚¹ãŒå¤šãã†ã§ã™ã€‚å¿µã®ãŸã‚ä¸Šã‹ã‚‰è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚ãªãŠã€å½“æ–¹ã®ä¸»è¦³ã§å¯¾å¿œã™ã‚‹å¤‰æ›´ã‚’è¨˜è¼‰ã—ã¦ã„ã¾ã™ãŒã€èªè­˜ãŒé–“é•ã£ã¦ã„ã‚‹å¯èƒ½æ€§ã¯ååˆ†ã‚ã‚Šã¾ã™ã€‚ã‚‚ã—ã€èªè­˜é–“é•ã£ã¦ã„ã‚‹ç®‡æ‰€ãŒã‚ã‚Œã° GitHub ã‹ã‚‰ Issue ã¾ãŸ PR ã‚’ä½œæˆã—ã¦ã”æŒ‡æ‘˜ã„ãŸã ã‘ã¾ã™ã¨å¹¸ã„ã§ã™ã€‚

> * Clarify that the client id is an opaque string
> * Extensions may define additional error codes on a resource request
> * Improved formatting for error field definitions
> * Moved and expanded "scope" definition to introduction section
> * Split access token section into structure and request
> * Renamed b64token to token68 for consistency with RFC7235
> * Restored content from old appendix B about application/x-www-form-urlencoded
> * Clarified that clients must not parse access tokens
> * Expanded text around when redirect_uri parameter is required in the authorization request
> * Changed "permissions" to "privileges" in refresh token section for consistency
> * Consolidated authorization code flow security considerations
> * Clarified authorization code reuse - an authorization code can only obtain an access token once

### Clarify that the client id is an opaque string

Client ID ã¯ opaque ã§ã‚ã‚‹ã“ã¨ãŒæ˜è¨˜ã•ã‚Œã¾ã—ãŸã€‚Client ä½œæˆæ™‚ã®å…¥åŠ›ã¨ã—ã¦ Client ID ã‚’æŒ‡å®šå¯èƒ½ãª Authorization Server ã‚‚å­˜åœ¨ã—ã¦ã„ã‚‹ã‚ˆã†ãªæ°—ãŒã—ã¾ã™ãŒä»Šåº¦ã©ã†ã„ã£ãŸæ‰±ã„ã«ãªã‚‹ã®ã§ã—ã‚‡ã†ã€‚

![](/images/2605f50eb9f14f/clarify_that_the_client_id_is_an_opaque_string.png)

### Extensions may define additional error codes on a resource request

æ‹¡å¼µä»•æ§˜ã«ãŠã„ã¦è¿½åŠ ã®ã‚¨ãƒ©ãƒ¼ãŒå®šç¾©ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚‹ã“ã¨ãŒè¨˜è¼‰ã•ã‚Œã¾ã—ãŸã€‚

![](/images/2605f50eb9f14f/extensions_may_define_additional_error_codes_on_a_resource_request.png)

### Improved formatting for error field definitions

"3.  Protocol Endpoints" ã‚„ "5.  Resource Requests" ã® "Error Response" ã«ãŠã‘ã‚‹ã„ãã¤ã‹ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®èª¬æ˜ãŒå¢—ãˆã¦ã„ã‚‹æ°—ãŒã—ã¾ã™ã€‚

![](/images/2605f50eb9f14f/improved_formatting_for_error_field_definitions.png)

### Moved and expanded "scope" definition to introduction section

ã¾ãšã€"scope" ã®å®šç¾©ãŒ "1. Introduction" ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ç§»å‹•ã—ã¾ã—ãŸã€‚

![](/images/2605f50eb9f14f/moved_and_expanded_scope_definition_to_introduction_section_1.png)

ã¾ãŸã€scope ã«ã‚ˆã‚‹ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã®ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚ãŸã‚Šã®èª¬æ˜ã‚„ä¾‹ãªã©ãŒå¢—ãˆã¦ã„ã‚‹ã‚ˆã†ã«è¦‹å—ã‘ã‚‰ã‚Œã¾ã™ã€‚

![](/images/2605f50eb9f14f/moved_and_expanded_scope_definition_to_introduction_section_2.png)

![](/images/2605f50eb9f14f/moved_and_expanded_scope_definition_to_introduction_section_3.png)

### Split access token section into structure and request

Access Token ã«é–¢ã™ã‚‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒåˆ†å‰²ã•ã‚ŒãŸã¨ã®ã“ã¨ã§ã™ã€‚
ç¢ºã‹ã«ã€"1.4. Access Token"ã€"5. Resource Requests" ã¨ã„ã£ãŸå½¢å¼ã§ç« ãŒåˆ†å‰²ã•ã‚Œã€å†…å®¹ã‚‚ä¸€éƒ¨è¿½è¨˜ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

![](/images/2605f50eb9f14f/split_access_token_section_into_structure_and_request_1.png)

![](/images/2605f50eb9f14f/split_access_token_section_into_structure_and_request_2.png)

### Renamed b64token to token68 for consistency with RFC7235

"b64token" ã¨ã„ã†ç”¨èªãŒä½¿ç”¨ã•ã‚Œã¦ã„ãŸç®‡æ‰€ãŒ "token68" ã«å¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚
ç¢ºã‹ã« "[RFC 7235 Hypertext Transfer Protocol (HTTP/1.1): Authentication](https://datatracker.ietf.org/doc/html/rfc7235)" ã§ã¯ "b64token" ã¨ã„ã†ç”¨èªã¯å‡ºã¦ã“ãš "token68" ã¨ã„ã†ç”¨èªãŒä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚

![](/images/2605f50eb9f14f/renamed_b64token_to_token68_for_consistency_with_RFC7235.png)

### Restored content from old appendix B about application/x-www-form-urlencoded

Appendix B ã®å†…å®¹ãŒ TBD ã«ãªã£ã¦ã„ã¾ã—ãŸãŒãƒªã‚¹ãƒˆã‚¢ã•ã‚ŒãŸã‚ˆã†ã§ã™ã€‚[GitHub Issue](https://github.com/oauth-wg/oauth-v2-1/issues/128) ã§ã®è­°è«–ã¯ç¶™ç¶šã•ã‚Œã¦ã„ã¾ã™ã€‚

![](/images/2605f50eb9f14f/restored_content_from_old_appendix_B.png)

### Clarified that clients must not parse access tokens

Client ã¯ Access Token ã‚’è§£æã—ã¦ã¯ãªã‚‰ãªã„ã“ã¨ãŒæ˜è¨˜ã•ã‚Œã¾ã—ãŸã€‚

![](/images/2605f50eb9f14f/clarified_that_clients_must_not_parse_access_tokens.png)

ãªãœ Client ãŒ Access Token ã‚’è§£æã—ã¦ã¯ãƒ€ãƒ¡ãªã®ã‹ã¨ã„ã†ã®ã¯ãƒˆãƒ¼ã‚¯ãƒ³ã®ã‚ªãƒ¼ãƒ‡ã‚£ãƒ³ã‚¨ã‚¹ã®æ¦‚å¿µã¨ä½µã›ã¦ç†è§£ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚
ãƒˆãƒ¼ã‚¯ãƒ³ã®ã‚ªãƒ¼ãƒ‡ã‚£ã‚¨ãƒ³ã‚¹ã®æ¦‚å¿µã«ã¤ã„ã¦ã¯ã€å€‹äººçš„ã«æœ€è¿‘è¦‹ãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ä¸­ã ã¨ä»¥ä¸‹ã®å‹•ç”»ãŒã‚ã‹ã‚Šã‚„ã™ã„ã¨æ€ã„ã¾ã—ãŸã€‚

https://youtu.be/h5RVZqEGhEo?si=hCuDhcSADiqbff4X

JWT å½¢å¼ã® Access Token ã®åˆ©ç”¨ã‚‚å¢—ãˆã¦ãã¦ã„ã‚‹ãŸã‚ã“ã“ã‚‰è¾ºã®æ¦‚å¿µã‚’å†ç¢ºèªã—ã¦ãŠãã¨è‰¯ã„ã‹ã‚‚ã—ã‚Œãªã„ã§ã™ã­ã€‚

### Expanded text around when redirect_uri parameter is required in the authorization request

Authorization Request ã§ redirect_uri ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ãŒå¿…è¦ãªå ´åˆã ã‘ã§ãªãå¿…è¦ã§ãªã„å ´åˆã®èª¬æ˜ãŒè¿½è¨˜ã•ã‚Œã¾ã—ãŸã€‚

![](/images/2605f50eb9f14f/expanded_text_around_when_redirect_uri_parameter.png)

### Changed "permissions" to "privileges" in refresh token section for consistency

"1.3.2. Refresh Token" ã«ãŠã„ã¦ "permissions" ã¨ã„ã†ç”¨èªãŒ "privileges" ã«ç½®ãæ›ãˆã‚‰ã‚Œã¾ã—ãŸã€‚

![](/images/2605f50eb9f14f/changed_permissions_to_privileges_in_refresh_token_section_for_consistency.png)

### Consolidated authorization code flow security considerations

Authorization Code ã«é–¢ã™ã‚‹ Security Considerations ãŒ "7.5. Authorization Code Security Considerations" ã¨ã—ã¦çºã‚ã‚‰ã‚Œã¦æ¢ã—ã‚„ã™ããªã‚Šã¾ã—ãŸã€‚

![](/images/2605f50eb9f14f/consolidated_authorization_code_flow_security_considerations_1.png)

### Clarified authorization code reuse - an authorization code can only obtain an access token once

"7.5.3. Reuse of Authorization Codes" ã¨ã„ã†ç« ãŒè¿½è¨˜ã•ã‚Œã¦ Authorization Code ã®å†åˆ©ç”¨ã«ã¤ã„ã¦æ˜è¨˜ã•ã‚Œã¾ã—ãŸã€‚
ã²ã¨ã¤ã® Authorization Code ã‚’ä½¿ç”¨ã—ã¦ Access Token ã‚’å–å¾—ã§ãã‚‹ã®ã¯ä¸€åº¦ã ã‘ã§ã‚ã‚Šã€Authorization Code ã‚’å†åˆ©ç”¨ã—ãŸå ´åˆã¯ Token Request ã‚’æ‹’å¦ã—ã¤ã¤ç™ºè¡Œã•ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³ã‚’å¤±åŠ¹ã•ã›ã‚‹ã“ã¨ã§é˜²ãã“ã¨ãŒã§ãã‚‹è¢«å®³ãªã©ã«ã¤ã„ã¦ã®è¨˜è¼‰ãŒã‚ã‚Šã¾ã™ã€‚ä¸€æ–¹ã§ Authorization Code ãŠã‚ˆã³å½“è©² Authorization Code ã‚’ä½¿ç”¨ã—ã¦ç™ºè¡Œã•ã‚ŒãŸ Access Token ã®è¨˜éŒ²ã‚„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¿œã˜ãŸ Access Token ã®å¤±åŠ¹å‡¦ç†ãŒå¿…è¦ã«ãªã‚Šå®Ÿè£…ãŒè¤‡é›‘ã«ãªã‚‹ã“ã¨ã‚‚æƒ³å®šã•ã‚Œã¾ã™ã€‚

![](/images/2605f50eb9f14f/clarified_authorization_code_reuse.png)

## ãŠã‚ã‚Š

æ–°è¦ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¿½åŠ ã¯å°‘ãªã‚ã§ã—ãŸãŒã€ä»•æ§˜ã¨ã—ã¦æ˜è¨˜ã—ã¦ã‚‚ã‚‰ãˆã‚‹ã¨èª°ã‹ãŒåŠ©ã‹ã‚‹ã‚ˆã†ãªå†…å®¹ã®è¿½è¨˜ãŒè¤‡æ•°ãŠã“ãªã‚ã‚Œã¦ã„ã‚‹ã‚ˆã†ãªå°è±¡ã§ã—ãŸã€‚

ãªãŠã€å€‹äººçš„ã«ã¯ã ã„ã¶ã‚¿ã‚¤ãƒ ãƒªãƒ¼ãªè©±é¡ŒãŒãŠãŠãã¦èˆˆå‘³æ·±ã„å¤‰æ›´ã§ã—ãŸã€‚
(ä¾‹ãˆã°ã€å‰²ã¨æœ€è¿‘ Identity Dance School ã® Discord ã§ãƒˆãƒ¼ã‚¯ãƒ³ã®ã‚ªãƒ¼ãƒ‡ã‚£ã‚¨ãƒ³ã‚¹ã®ç–‘å•ã«ã¤ã„ã¦æŠ•ã’ã‹ã‘ã•ã›ã¦ã‚‚ã‚‰ã£ãŸã‚Šã€[GitHub Issue](https://github.com/oauth-wg/oauth-v2-1/issues/128#issuecomment-1879632883) ã§è­°è«–ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ãª[ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã«é–¢ã™ã‚‹ãƒã‚°](https://github.com/panva/node-openid-client/pull/627)ã‚’è¸ã‚“ã ã‚Šã—ã¦ã„ã¾ã—ãŸã€‚)

![](/images/2605f50eb9f14f/iddance_discord.png)

ã§ã¯ã¾ãŸï¼
