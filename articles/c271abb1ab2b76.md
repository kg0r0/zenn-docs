---
title: "SimpleWebAuthn ã‚’ä½¿ç”¨ã—ãŸ WebAuthn ã® Relying Party ã®å®Ÿè£…ã®å‹˜æ‰€ (TypeScript)"
emoji: "ğŸ”‘"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["fido"]
published: false
---

Digital Identity æŠ€è¡“å‹‰å¼·ä¼š #iddance Advent Calendar 2023 3 æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚

https://qiita.com/advent-calendar/2023/iddance

æœ¬æŠ•ç¨¿ã§ã¯ã€SimpleWebAuthn[^1] ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã¦ Web Authentication (WebAuthn) ã® Relying Party (RP) ã‚’å®Ÿè£…ã—ã€é–‹ç™ºã™ã‚‹ã†ãˆã§æ„è­˜ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ç®‡æ‰€ãªã©ã®å‹˜æ‰€ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚

https://simplewebauthn.dev/docs/

ãªãŠã€é€šå¸¸ã€WebAuthn ã® RP ã‚’å®Ÿè£…ã™ã‚‹ã†ãˆã§åˆ©ç”¨å¯èƒ½ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯å„è¨€èªã”ã¨ã«ç”¨æ„ã•ã‚Œã¦ãŠã‚Šã€ç‰¹å®šã®è¨€èªã§ã‚‚è¤‡æ•°ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå…¬é–‹ã•ã‚Œã¦ã„ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
æœ¬å½“æŠ•ç¨¿ã§ç´¹ä»‹ã™ã‚‹ã®ã¯ã‚ãã¾ã§ãã®ã†ã¡ã®ä¸€ã¤ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚ã‚Šã€å®Ÿè£…ã«ãŠã„ã¦è€ƒæ…®ãŒå¿…è¦ãªç‚¹ã¯ã€åˆ©ç”¨ã™ã‚‹è¨€èªã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãªã©ã«ã‚ˆã£ã¦ç•°ãªã‚‹ç‚¹ã«ç•™æ„ã—ã¦ãã ã•ã„ã€‚
ã©ã†ã„ã£ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå­˜åœ¨ã—ã¦ã„ã‚‹ã‹ã«ã¤ã„ã¦ã¯ã€ä¾‹ãˆã°ã€WebAuthn Awesom[^2] ã¨ã„ã†ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰æ¢ã™ã“ã¨ãŒã§ãã‚‹ãŸã‚ã€é©å®œã”ç¢ºèªãã ã•ã„ã€‚

# ã¯ã˜ã‚ã«

ã¾ãšã€WebAuthn ã® RP ã‚’å®Ÿè£…ã™ã‚‹ã†ãˆã§ã€å°‘ãªãã¨ã‚‚ç™»éŒ²ãŠã‚ˆã³èªè¨¼ã®å¤§ã¾ã‹ãªãƒ•ãƒ­ãƒ¼ã‚’çŸ¥ã£ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ç™»éŒ²ãŠã‚ˆã³èªè¨¼ã®ãƒ•ãƒ­ãƒ¼ã«ã¤ã„ã¦ã¯ã€WebAuthn ã®ä»•æ§˜ã®å›³[^3]ãªã©ã‹ã‚‰ç¢ºèªã§ãã€ã‚µãƒ¼ãƒãƒ¼å´ãŠã‚ˆã³ãƒ–ãƒ©ã‚¦ã‚¶å´ã«ã‚ˆã‚‹å‡¦ç†ãŒå¿…è¦ã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚
ä»¥ä¸‹ã®å›³ã¯ã€WebAuthn ã®ä»•æ§˜[^3]ã‹ã‚‰å¼•ç”¨ã—ãŸç™»éŒ²ãŠã‚ˆã³èªè¨¼æ™‚ã®ãƒ•ãƒ­ãƒ¼ã§ã™ã€‚WebAuthn ã® RP ã‚’å®Ÿè£…ã™ã‚‹å ´åˆã€_Relying Party Server_ ãŠã‚ˆã³ _RP JavaScript Application_ ã§è¡Œã†å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚å…·ä½“çš„ã«ã¯ã€å›³ä¸­ã® (1) (5) (6) ã«è©²å½“ã™ã‚‹å‡¦ç†ã§ã‚ã‚Šã€RP ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ãƒ–ãƒ©ã‚¦ã‚¶ã¸ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®é€ä¿¡ã€WebAuthnAPI ã®å‘¼ã³å‡ºã— (`navigator.credentials.create()` or `navigator.credentials.get()`)ã€RP ã‚µãƒ¼ãƒãƒ¼ã«å¯¾ã™ã‚‹ WebAuthnAPI å‘¼ã³å‡ºã—çµæœã®é€ä¿¡ã€RP ã‚µãƒ¼ãƒãƒ¼ã«ã‚ˆã‚‹ WebAuthnAPI å‘¼ã³å‡ºã—çµæœã®æ¤œè¨¼ãªã©ã«ãªã‚Šã¾ã™ã€‚
å›³ä¸­ã® (2) (3) (4) ã«ã¤ã„ã¦ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§ WebAuthn API ã‚’å‘¼ã³å‡ºã—ãŸã®ã¡ã®å‡¦ç†ã§ã‚ã‚Šã€é€šå¸¸ã€WebAuthn ã® RP ã®å®Ÿè£…ã«ãŠã„ã¦æ„è­˜ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

![Registration Flow](/images/c271abb1ab2b76/webauthn-registration-flow-01.png)
_Registration Flow[^3]_

![Authentication Flow](/images/c271abb1ab2b76/webauthn-authentication-flow-01.png)
_Authentication Flow[^3]_

_Relying Party Server_ ã¨ _RP JavaScript Application_ é–“ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŠã‚ˆã³ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ä¾‹ã¯ Server Requirements and Transport Binding Profile[^4] ãªã©ã‹ã‚‰ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ä¾‹ãˆã°ã€`/attestation/options`ã€`/attestation/result`ã€`/attestation/options`ã€`/assertion/result` ã¨ã„ã£ãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ç”¨æ„ã—ã¦ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®é€ä¿¡ãŠã‚ˆã³çµæœã®æ¤œè¨¼ã‚’è¡Œã†ã“ã¨ãŒã§ãã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

https://fidoalliance.org/specs/fido-v2.0-rd-20180702/fido-server-v2.0-rd-20180702.html

ã“ã®æ™‚ç‚¹ã§ WebAuthn ã§ã¯å¤šãã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’æ‰±ã†å¿…è¦ãŒã‚ã‚‹ã“ã¨ã«æ°—ã¥ãã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
ã¾ãŸã€WebAuth API ã®çµæœã¯ä»¥ä¸‹ã®ã‚ˆã†ãªæ§‹é€ ã®ãƒ‡ãƒ¼ã‚¿ã«ãªã£ã¦ã„ã¾ã™ã€‚ã“ã®ä¸­ã«ã¯ã€CBOR (Concise Binary Object Representation) ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸattestationObjectã€authenticatorData ã¨ã„ã£ãŸãƒ‡ãƒ¼ã‚¿ãŒå«ã¾ã‚Œã¦ãŠã‚Šã€ã“ã‚Œã‚‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦å–å¾—ã§ãã‚‹å€¤ãªã©ã‚’ä½¿ç”¨ã—ã¦æ¤œè¨¼å‡¦ç†ãŒè¡Œã‚ã‚Œã¾ã™ã€‚

*Authenticator Attestation Response:*
```json
{
    "id": "LFdoCFJTyB82ZzSJUHc-c72yraRc_1mPvGX8ToE8su39xX26Jcqd31LUkKOS36FIAWgWl6itMKqmDvruha6ywA",
    "rawId": "LFdoCFJTyB82ZzSJUHc-c72yraRc_1mPvGX8ToE8su39xX26Jcqd31LUkKOS36FIAWgWl6itMKqmDvruha6ywA",
    "response": {
        "clientDataJSON": "eyJjaGFsbGVuZ2UiOiJOeHlab3B3VktiRmw3RW5uTWFlXzVGbmlyN1FKN1FXcDFVRlVLakZIbGZrIiwiY2xpZW50RXh0ZW5zaW9ucyI6e30sImhhc2hBbGdvcml0aG0iOiJTSEEtMjU2Iiwib3JpZ2luIjoiaHR0cDovL2xvY2FsaG9zdDozMDAwIiwidHlwZSI6IndlYmF1dGhuLmNyZWF0ZSJ9",
        "attestationObject": "o2NmbXRoZmlkby11MmZnYXR0U3RtdKJjc2lnWEcwRQIgVzzvX3Nyp_g9j9f2B-tPWy6puW01aZHI8RXjwqfDjtQCIQDLsdniGPO9iKr7tdgVV-FnBYhvzlZLG3u28rVt10YXfGN4NWOBWQJOMIICSjCCATKgAwIBAgIEVxb3wDANBgkqhkiG9w0BAQsFADAuMSwwKgYDVQQDEyNZdWJpY28gVTJGIFJvb3QgQ0EgU2VyaWFsIDQ1NzIwMDYzMTAgFw0xNDA4MDEwMDAwMDBaGA8yMDUwMDkwNDAwMDAwMFowLDEqMCgGA1UEAwwhWXViaWNvIFUyRiBFRSBTZXJpYWwgMjUwNTY5MjI2MTc2MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEZNkcVNbZV43TsGB4TEY21UijmDqvNSfO6y3G4ytnnjP86ehjFK28-FdSGy9MSZ-Ur3BVZb4iGVsptk5NrQ3QYqM7MDkwIgYJKwYBBAGCxAoCBBUxLjMuNi4xLjQuMS40MTQ4Mi4xLjUwEwYLKwYBBAGC5RwCAQEEBAMCBSAwDQYJKoZIhvcNAQELBQADggEBAHibGMqbpNt2IOL4i4z96VEmbSoid9Xj--m2jJqg6RpqSOp1TO8L3lmEA22uf4uj_eZLUXYEw6EbLm11TUo3Ge-odpMPoODzBj9aTKC8oDFPfwWj6l1O3ZHTSma1XVyPqG4A579f3YAjfrPbgj404xJns0mqx5wkpxKlnoBKqo1rqSUmonencd4xanO_PHEfxU0iZif615Xk9E4bcANPCfz-OLfeKXiT-1msixwzz8XGvl2OTMJ_Sh9G9vhE-HjAcovcHfumcdoQh_WM445Za6Pyn9BZQV3FCqMviRR809sIATfU5lu86wu_5UGIGI7MFDEYeVGSqzpzh6mlcn8QSIZoYXV0aERhdGFYxEmWDeWIDoxodDQXD2R2YFuP5K65ooYyx5lc87qDHZdjQQAAAAAAAAAAAAAAAAAAAAAAAAAAAEAsV2gIUlPIHzZnNIlQdz5zvbKtpFz_WY-8ZfxOgTyy7f3Ffbolyp3fUtSQo5LfoUgBaBaXqK0wqqYO-u6FrrLApQECAyYgASFYIPr9-YH8DuBsOnaI3KJa0a39hyxh9LDtHErNvfQSyxQsIlgg4rAuQQ5uy4VXGFbkiAt0uwgJJodp-DymkoBcrGsLtkI"
    },
    "type": "public-key"
}
```
*Authenticator Assertion Response:*
```json
{
    "id":"LFdoCFJTyB82ZzSJUHc-c72yraRc_1mPvGX8ToE8su39xX26Jcqd31LUkKOS36FIAWgWl6itMKqmDvruha6ywA",
    "rawId":"LFdoCFJTyB82ZzSJUHc-c72yraRc_1mPvGX8ToE8su39xX26Jcqd31LUkKOS36FIAWgWl6itMKqmDvruha6ywA",
    "response":{
        "authenticatorData":"SZYN5YgOjGh0NBcPZHZgW4_krrmihjLHmVzzuoMdl2MBAAAAAA",
        "signature":"MEYCIQCv7EqsBRtf2E4o_BjzZfBwNpP8fLjd5y6TUOLWt5l9DQIhANiYig9newAJZYTzG1i5lwP-YQk9uXFnnDaHnr2yCKXL",
        "userHandle":"",
        "clientDataJSON":"eyJjaGFsbGVuZ2UiOiJ4ZGowQ0JmWDY5MnFzQVRweTBrTmM4NTMzSmR2ZExVcHFZUDh3RFRYX1pFIiwiY2xpZW50RXh0ZW5zaW9ucyI6e30sImhhc2hBbGdvcml0aG0iOiJTSEEtMjU2Iiwib3JpZ2luIjoiaHR0cDovL2xvY2FsaG9zdDozMDAwIiwidHlwZSI6IndlYmF1dGhuLmdldCJ9"
    },
    "type":"public-key"
}
```

é€šå¸¸ã€WebAuthn ã® RP ã‚’å®Ÿè£…ã—ã€æ„å›³ã—ãŸèªè¨¼å™¨ã‚’ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã†ãˆã§ä¸Šè¨˜ã®ã‚ˆã†ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã«ã¤ã„ã¦ç†è§£ã™ã‚‹ã“ã¨ã¯é‡è¦ã§ã™ã€‚
å„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã®è©³ç´°ã«ã¤ã„ã¦ã¯ WebAuthn ã®ä»•æ§˜[^3]ã‹ã‚‰ç¢ºèªã§ãã¾ã™ãŒã€æ—¥æœ¬èªã§è§£èª¬ã•ã‚ŒãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ[^5]ãªã©ã‚‚å­˜åœ¨ã—ã¦ã„ã‚‹ãŸã‚ä½µã›ã¦å‚ç…§ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚

# å®Ÿè£…ä¾‹

SimpleWebAuthn ã‚’ä½¿ç”¨ã—ãŸ WebAuthn ã® RP ã®å®Ÿè£…ä¾‹ã«ã¤ã„ã¦ã¯ã€SimpleWebAuthn ã®ãƒªãƒã‚¸ãƒˆãƒªä¸Šã® ``example`` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸Šã«å­˜åœ¨ã—ã¦ãŠã‚Šã€ã“ã¡ã‚‰ã‹ã‚‰ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

https://github.com/MasterKale/SimpleWebAuthn/tree/master/example

ä»Šå›ã¯ Server Requirements and Transport Binding Profile[^4] ã«åˆã‚ã›ã‚‹å½¢ã§å®Ÿè£…ä¾‹ã‚’ç”¨æ„ã—ã¦ã¿ãŸãŸã‚ã€ã“ã¡ã‚‰ã‚’ã‚‚ã¨ã«èª¬æ˜ã‚’ã—ã¾ã™ã€‚
ã“ã®å®Ÿè£…ä¾‹ã§ã¯ã€YubiKey 5 Series ã‚’èªè¨¼å™¨ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹æƒ³å®šã§å®Ÿè£…ã‚’ãŠã“ãªã£ã¦ã„ã¾ã™ã€‚æƒ³å®šã™ã‚‹èªè¨¼å™¨ã¨ã—ã¦ YubiKey 5 Series ã‚’é¸æŠã—ãŸç†ç”±ã¨ã—ã¦ã¯ã€å¤šãã®æ–¹ã«èªçŸ¥ã•ã‚Œã¦ã„ã‚‹èªè¨¼å™¨ã®ä¸€ã¤ã§ã‚ã‚Šã€å¾Œè¿°ã® User Presenceï¼ˆUPï¼‰ã¨ User Verificationï¼ˆUVï¼‰ã®é•ã„ã‚’åˆ©ç”¨ã—ã¦å—ã‘å…¥ã‚Œã‚‹èªè¨¼å™¨ã®æ¡ä»¶ã®è¨­å®šãªã©ãŒå¯èƒ½ãªãŸã‚ã§ã™ã€‚

https://github.com/kg0r0/simplewebauthn-example

:::message alert
æƒ³å®šã™ã‚‹èªè¨¼å™¨ã‚„æ¤œè¨¼å‡¦ç†ãªã©ã€ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«å¿œã˜ã¦é©åˆ‡ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ã“ã“ã§ç´¹ä»‹ã™ã‚‹ã®ã¯ã‚ãã¾ã§å®Ÿè£…ä¾‹ã§ã‚ã‚Šã€ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«ã‚ˆã£ã¦æŒ‡å®šã™ã‚‹ã¹ãé©åˆ‡ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã¯ç•°ãªã‚‹ãŸã‚ã€å‚è€ƒã«ã™ã‚‹éš›ã¯å¿…ãšã”è‡ªèº«ã§æƒ³å®šã—ãŸé€šã‚Šã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ååˆ†ã«ç¢ºèªã—ã¦ãã ã•ã„ã€‚
:::

## ç™»éŒ²

Relying Party Server ã§ã¯ã€WebAuthn API ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’é€ä¿¡ã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨ WebAuthn API ã®çµæœã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€RP JavaScript Application ã§ã¯ WebAuthn API (``navigator.credentials.create()``) ã®å‘¼ã³å‡ºã—ã‚’ãã‚Œãã‚Œå®Ÿè£…ã—ã¾ã™ã€‚ã€‚

![Registration Flow](/images/c271abb1ab2b76/webauthn-registration-flow-02.png)
_Registration Flow[^3]_

### Relying Party Server

Relying Party Server ã§ã¯ã€WebAuthn API ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’é€ä¿¡ã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ ``/attestation/options`` ã¨ WebAuthn API ã®çµæœã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ ``/attestation/result`` ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

ä¸Šè¨˜ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å®Ÿè£…ã™ã‚‹å ´åˆã€ä»¥ä¸‹ã® SimpleWebAuthn ã® Server å´ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ[^6]ã‚’å‚ç…§ã—ã¾ã™ã€‚

https://simplewebauthn.dev/docs/packages/server#registration

#### Credential Creation Options

``generateRegistrationOptions()`` ã‚’å‘¼ã³å‡ºã—ã¦ WebAuthn API ``navigator.credentials.create()`` ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿”ã—ã¾ã™ã€‚
ã‚ã¨ã§ WebAuthn API ã®çµæœã‚’æ¤œè¨¼ã™ã‚‹éš›ã«å¿…è¦ã¨ãªã‚‹ challenge ã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ä¿å­˜ã—ã¦ãŠãã¾ã™ã€‚

```js:src/routes/attestation.ts
import {
  generateRegistrationOptions,
} from '@simplewebauthn/server';
import { AuthenticatorDevice, RegistrationResponseJSON } from '@simplewebauthn/typescript-types';
...

router.post('/options', async (req: Request, res: Response) => {
  ...
  const credentialCreationOptions = await generateRegistrationOptions({
    rpName,
    rpID,
    userID: user.id,
    userName: user.username,
    attestationType: 'direct',
    excludeCredentials: user.authenticators.map(authenticator => ({
      id: authenticator.credentialID,
      type: 'public-key',
      transports: authenticator.transports,
    })),
    authenticatorSelection: {
      residentKey: 'discouraged',
      userVerification: 'discouraged',
      authenticatorAttachment: 'cross-platform',
    },
  });
  ...
  req.session.currentChallenge = options.challenge;
  ...
});
```

ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®è©³ç´°ã¯ä»¥ä¸‹ã® W3C ã® WebAuthentication ã®ä»•æ§˜[^3]ã‹ã‚‰ã‚‚ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
https://www.w3.org/TR/webauthn-3/#dictdef-publickeycredentialcreationoptions

ä¾‹ãˆã°ã€ã“ã“ã§ã¯ YubiKey ã‚’èªè¨¼å™¨ã¨ã—ã¦å‘¼ã³å‡ºã™ãŸã‚ã« ``authenticatorAttachment: 'cross-platform'`` ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚ã¾ãŸã€User Verification ã‚’è¦æ±‚ã—ãªã„ã‚ˆã†ã« ``userVerification: 'discouraged'`` ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ã€å‘¼ã³å‡ºã™æƒ³å®šã®èªè¨¼å™¨ã®ç¨®é¡ã‚„è¦æ±‚ã™ã‚‹ã¹ãèªè¨¼å¼·åº¦ã«ã‚ˆã£ã¦é©åˆ‡ãªå€¤ã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

#### Authenticator Attestation Response

``verifyRegistrationResponse()`` ã‚’å‘¼ã³å‡ºã—ã¦ WebAuthn API ``navigator.credentials.create()`` ã®çµæœã‚’æ¤œè¨¼ã—ã¾ã™ã€‚
ã“ã“ã§ã‚‚ã€å—ã‘å…¥ã‚Œã‚‹èªè¨¼å™¨ãªã©ã«å¿œã˜ã¦é©åˆ‡ãªå€¤ã‚’å¼•æ•°ã¨ã—ã¦æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
Relying Party Server ã¯ã€``verification.verified`` ãŒ true ã®å ´åˆã«ç™»éŒ²æƒ…å ±ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã—ã¾ã™ã€‚

```js:src/routes/attestation.ts
import {
  VerifyRegistrationResponseOpts,
  verifyRegistrationResponse
} from '@simplewebauthn/server';
import { AuthenticatorDevice, RegistrationResponseJSON } from '@simplewebauthn/typescript-types';
import { isoUint8Array } from '@simplewebauthn/server/helpers';
...
router.post('/result', async (req: Request, res: Response) => {
  ...
  const expectedChallenge = req.session.currentChallenge;
  const opts: VerifyRegistrationResponseOpts = {
    response: body,
    expectedChallenge: `${expectedChallenge}`,
    expectedOrigin: origin,
    expectedRPID: rpID,
    requireUserVerification: false,
  };
  let verification;
  try {
    verification = await verifyRegistrationResponse(opts);
  } catch (error) {
    res.json({
      status: 'failed',
      errorMessage: (error as Error).message
    });
    return
  }
  const { verified, registrationInfo } = verification;
  if (!verified || !registrationInfo) {
    res.json({
      status: 'failed',
      errorMessage: 'Can not validate response signature.'
    })
    return;
  }
  const { credentialPublicKey, credentialID, counter } = registrationInfo;
  const user = database[username];
  const existingAuthenticator = user.authenticators.find(authenticator =>
    isoUint8Array.areEqual(authenticator.credentialID, credentialID)
  );
  if (!existingAuthenticator) {
    const newDevice: AuthenticatorDevice = {
      credentialID,
      credentialPublicKey,
      counter,
      transports: body.response.transports,
    }
    user.authenticators.push(newDevice);
  }
  req.session.currentChallenge = undefined;
  ...
});
```

### RP JavaScript Application

Relying Party Server ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ ``/attestation/options``ã€€ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã€å–å¾—ã—ãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’ã‚‚ã¨ã« WebAuthn API ``navigator.credentials.create()`` ã‚’å®Ÿè¡Œã—ã€çµæœã‚’ Relying Party Server ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ ``/attestation/result`` ã«é€ä¿¡ã™ã‚‹å‡¦ç†ã‚’å®Ÿè£…ã—ã¾ã™ã€‚
ã“ã“ã§ã¯ã€ä»¥ä¸‹ã® SimpleWebAuthn ã® Browser å´ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ[^7]ã‚’å‚ç…§ã—ã¾ã™ã€‚

https://simplewebauthn.dev/docs/packages/browser#startregistration

``/attestation/options`` ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã€å–å¾—ã—ãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ ``startRegistration()`` ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚
``startRegistration()`` çµŒç”±ã§ WebAuthn API ``navigator.credentials.create()`` ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹ãŸã‚ã€çµæœã‚’ ``'/attestation/result`` ã«é€ä¿¡ã—ã¾ã™ã€‚

```js:src/public/index.html
<!DOCTYPE html>
...
<script src="https://unpkg.com/@simplewebauthn/browser/dist/bundle/index.umd.min.js"></script>
...
<button type="submit" id="register" onclick="register()">Register</button>
...
<script>
  async function register() {
    const { startRegistration } = SimpleWebAuthnBrowser;
    ...
    const resp = await fetch('/attestation/options', {
      method: 'POST',
      credentials: 'same-origin',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        username: username.value
      })
    });
    let attResp;
    try {
      attResp = await startRegistration(await resp.json());
    } catch (error) {
      if (error.name === 'InvalidStateError') {
        elemError.innerText = 'Error: Authenticator was probably already registered by user';
      } else {
        elemError.innerText = error;
      }
      throw error;
    }
    const verificationResp = await fetch('/attestation/result', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(attResp),
    });
    const verificationJSON = await verificationResp.json();

    if (verificationJSON && verificationJSON.status === 'ok') {
      elemSuccess.innerText = 'Successfully registered!';
    } else {
      elemError.innerText = 'Error: ' + verificationJSON.errorMessage;
    }
  }
  ...
</script>
</html>
```

## èªè¨¼

Relying Party Server ã§ã¯ã€WebAuthn API ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’é€ä¿¡ã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨ WebAuthn API ã®çµæœã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€RP JavaScript Application ã§ã¯ WebAuthn API (``navigator.credentials.get()``) ã®å‘¼ã³å‡ºã—ã‚’ãã‚Œãã‚Œå®Ÿè£…ã—ã¾ã™ã€‚ã€‚

![Authentication Flow](/images/c271abb1ab2b76/webauthn-authentication-flow-02.png)
_Authentication Flow[^3]_

### Relying Party Server

Relying Party Server ã§ã¯ã€WebAuthn API ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’é€ä¿¡ã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ ``/assertion/options`` ã¨ WebAuthn API ã®çµæœã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ ``/assertion/result`` ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

ä¸Šè¨˜ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å®Ÿè£…ã™ã‚‹å ´åˆã€ä»¥ä¸‹ã® SimpleWebAuthn ã® Server å´ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ[^6]ã‚’å‚ç…§ã—ã¾ã™ã€‚

https://simplewebauthn.dev/docs/packages/server#authentication

#### Credential Get Options

``generateAuthenticationOptions(()`` ã‚’å‘¼ã³å‡ºã—ã¦ WebAuthn API ``navigator.credentials.get()`` ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿”ã—ã¾ã™ã€‚
ã‚ã¨ã§ WebAuthn API ã®çµæœã‚’æ¤œè¨¼ã™ã‚‹éš›ã«å¿…è¦ã¨ãªã‚‹ challenge ã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ä¿å­˜ã—ã¦ãŠãã¾ã™ã€‚

```js:src/routes/assertion.ts

import {
  generateAuthenticationOptions,
} from '@simplewebauthn/server';
import type {
  GenerateAuthenticationOptionsOpts,
} from '@simplewebauthn/server';
import { AuthenticationResponseJSON } from '@simplewebauthn/server/script/deps';
import { isoBase64URL, isoUint8Array } from '@simplewebauthn/server/helpers';
...
router.post('/options', async (req: Request, res: Response) => {
  ...
  const opts: GenerateAuthenticationOptionsOpts = {
    timeout: 60000,
    allowCredentials: user.authenticators.map(authenticator => ({
      id: authenticator.credentialID,
      type: 'public-key',
      transports: authenticator.transports,
    })),
    userVerification: 'discouraged',
    rpID
  }
  const credentialGetOptions = await generateAuthenticationOptions(opts);
  ...
  req.session.currentChallenge = options.challenge;
  ...
});
```

ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®è©³ç´°ã¯ä»¥ä¸‹ã® W3C ã® WebAuthentication ã®ä»•æ§˜[^3]ã‹ã‚‰ã‚‚ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

https://www.w3.org/TR/webauthn-3/#dictionary-assertion-options

#### Authenticator Assertion Response

``verifyAuthenticationResponse,()`` ã‚’å‘¼ã³å‡ºã—ã¦ WebAuthn API ``navigator.credentials.get()`` ã®çµæœã‚’æ¤œè¨¼ã—ã¾ã™ã€‚
ã“ã“ã§ã‚‚ã€ä½¿ç”¨ã™ã‚‹èªè¨¼å™¨ãªã©ã«å¿œã˜ã¦é©åˆ‡ãªå€¤ã‚’å¼•æ•°ã¨ã—ã¦æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
Relying Party Server ã¯ã€``verification.verified`` ãŒ true ã®å ´åˆã«ç™»éŒ²æƒ…å ±ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã—ã¾ã™ã€‚

```js:src/routes/assertion.ts
import {
  verifyAuthenticationResponse,
} from '@simplewebauthn/server';
import type {
  VerifiedAuthenticationResponse,
  VerifyAuthenticationResponseOpts,
} from '@simplewebauthn/server';
import { AuthenticationResponseJSON } from '@simplewebauthn/server/script/deps';
import { isoBase64URL, isoUint8Array } from '@simplewebauthn/server/helpers';

router.post('/result', async (req: Request, res: Response) => {
  const body: AuthenticationResponseJSON = req.body;
  const expectedChallenge = req.session.currentChallenge;
  ...
  let verification: VerifiedAuthenticationResponse;
  try {
    const opts: VerifyAuthenticationResponseOpts = {
      response: body,
      expectedChallenge: `${expectedChallenge}`,
      expectedOrigin: origin,
      expectedRPID: rpID,
      authenticator: dbAuthenticator,
      requireUserVerification: false
    };
    verification = await verifyAuthenticationResponse(opts);
  } catch (error) {
    return res.json({
      status: 'failed',
      errorMessage: (error as Error).message,
    });
  }
  const { verified, authenticationInfo } = verification;
  if (!verified || !authenticationInfo) {
    return res.json({
      status: 'failed',
      errorMessage: 'Can not authenticate signature.',
    });
  }
  dbAuthenticator.counter = authenticationInfo.newCounter;
  ...
});
```

### RP JavaScript Application

Relying Party Server ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ ``/assertion/options``ã€€ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã€å–å¾—ã—ãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’ã‚‚ã¨ã« WebAuthn API ``navigator.credentials.get()`` ã‚’å®Ÿè¡Œã—ã€çµæœã‚’ Relying Party Server ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ ``/assertion/result`` ã«é€ä¿¡ã™ã‚‹å‡¦ç†ã‚’å®Ÿè£…ã—ã¾ã™ã€‚
ã“ã“ã§ã¯ã€ä»¥ä¸‹ã® SimpleWebAuthn ã® Browser å´ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ[^7]ã‚’å‚ç…§ã—ã¾ã™ã€‚

https://simplewebauthn.dev/docs/packages/browser#startauthentication

``/assertion/options`` ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã€å–å¾—ã—ãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ ``startAuthentication()`` ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚
``startAuthentication()`` çµŒç”±ã§ WebAuthn API ``navigator.credentials.get()`` ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹ãŸã‚ã€çµæœã‚’ ``'/assertion/result`` ã«é€ä¿¡ã—ã¾ã™ã€‚

```js:src/public/index.html
<!DOCTYPE html>
<script src="https://unpkg.com/@simplewebauthn/browser/dist/bundle/index.umd.min.js"></script>
  ...
  async function authenticate() {
    const { startAuthentication } = SimpleWebAuthnBrowser;
    ...
    const resp = await fetch('/assertion/options', {
      method: 'POST',
      credentials: 'same-origin',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        username: username.value
      })
    });
    let asseResp;
    try {
      asseResp = await startAuthentication(await resp.json());
    } catch (error) {
      elemError.innerText = error;
    }
    const verificationResp = await fetch('/assertion/result', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(asseResp),
    });
    const verificationJSON = await verificationResp.json();

    if (verificationJSON && verificationJSON.status === 'ok') {
      elemSuccess.innerText = 'Successfully authenticated!';
      await getUserInfo();
    } else {
      elemError.innerText = 'Error: ' + verificationJSON.errorMessage;
    }
  }
  ...
</script>
</html>
```

# å‹•ä½œç¢ºèª

ä»Šå›å®Ÿè£…ã—ãŸã‚µãƒ³ãƒ—ãƒ«ã¯ä»¥ä¸‹ã®æ‰‹é †ã§å‹•ä½œç¢ºèªã§ãã¾ã™ã€‚

```bash
$ git clone https://github.com/kg0r0/simplewebauthn-example.git
$ cd simplewebauthn-example 
$ npm install
$ npm start
```

ç™»éŒ²ãŠã‚ˆã³èªè¨¼ã«ãŠã„ã¦èªè¨¼å™¨ã¨ã—ã¦ YubiKey ã‚’å‘¼ã³å‡ºã—ã¦ä½¿ç”¨ã§ãã‚‹ã“ã¨ãŒç¢ºèªã§ãã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

![WebAuthn Dialog](/images/c271abb1ab2b76/webauthn-use-securitykey.png)

ãªãŠã€ãƒ¡ã‚½ãƒƒãƒ‰ã®å¼•æ•°ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ã€è¿½åŠ ã®æ¤œè¨¼ã‚’ãŠã“ãªã†ã‚ˆã†ã«è¨­å®šã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

ä¾‹ãˆã°ã€ç™»éŒ²æ™‚ã« WebAuthn API ã®çµæœã«å«ã¾ã‚Œã‚‹ Attestation Object ã® FLAGS ã«ãŠã„ã¦ User Presenceï¼ˆUPï¼‰ã ã‘ã§ãªã User Verificationï¼ˆUVï¼‰ã‚’æ¤œè¨¼ã™ã‚‹ã‚ˆã†ã«è¨­å®šã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

![FLAGS](/images/c271abb1ab2b76/fido-attestation-structures-flags.png)

```js:src/routes/attestation.ts 
router.post('/result', async (req: Request, res: Response) => {
  ...
  const opts: VerifyRegistrationResponseOpts = {
    ...
    requireUserVerification: true,
  };
  ...
});
```

å†åº¦ YubiKey ã‚’èªè¨¼å™¨ã¨ã—ã¦ç™»éŒ²ã—ã‚ˆã†ã¨ã—ãŸå ´åˆã€``Error: User verification required, but user could not be verified`` ã¨ã„ã£ãŸã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã‚ˆã†ã«ãªã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã¾ã™ã€‚ã“ã‚Œã¯ã€Relying Party Server å´ã§ UV ã‚’æ¤œè¨¼ã™ã‚‹ã‚ˆã†ã«è¨­å®šã—ãŸã‚‚ã®ã® RP JavaScript Application å´ã§ UV ã‚’è¦æ±‚ã™ã‚‹ã‚ˆã†ã«è¨­å®šã•ã‚Œã¦ã„ãªã„ãŸã‚ã§ã™ã€‚
ã“ã“ã§ã€WebAuthn API å®Ÿè¡Œæ™‚ã« UV ã‚’è¦æ±‚ã™ã‚‹ã‚ˆã†ã« ``userVerification`` ã®å€¤ã‚’æŒ‡å®šã—ã¾ã™ã€‚

```js:src/routes/attestation.ts 
  const credentialCreationOptions = await generateRegistrationOptions({
    ...
    })),
    authenticatorSelection: {
      residentKey: 'discouraged',
      userVerification: 'required',
      authenticatorAttachment: 'cross-platform',
    },
  });
```

ã™ã‚‹ã¨ã€PIN ã®å…¥åŠ›ãŒè¦æ±‚ã•ã‚Œ User Verification ãŒè¡Œã‚ã‚Œã€UP ãŠã‚ˆã³ UV ãŒæ¤œè¨¼ã•ã‚ŒãŸã†ãˆã§èªè¨¼å™¨ã‚’ç™»éŒ²ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸ (ãªãŠã€YubiKey ã®å‹•ä½œã¨ã—ã¦ ``preferred`` ã‚’æŒ‡å®šã—ãŸå ´åˆã«ãŠã„ã¦ã‚‚ PIN ãŒè¦æ±‚ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹ã‚ˆã†ã§ã™[^8])ã€‚

![User Verification](/images/c271abb1ab2b76/webauthn-registration-userverification.png)

åŒæ§˜ã«ã€èªè¨¼æ™‚ã«ãŠã„ã¦ã‚‚ WebAuthn API ã®çµæœã« FLAGS ãŒå«ã¾ã‚Œã‚‹ãŸã‚ã€User Verificationï¼ˆUVï¼‰ã‚’æ¤œè¨¼ã™ã‚‹ã‚ˆã†ã«è¨­å®šã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

![FLAGS](/images/c271abb1ab2b76/fido-signature-formats-flags.png)
_Authenticator Data[^3]_

ã“ã®æ™‚ã‚‚ Relying Party Server ãŠã‚ˆã³ RP JavaScript Application å´ã§æ­£ã—ãè¨­å®šã‚’ãŠã“ãªã„ã¾ã™ã€‚

```js:src/routes/assertion.ts
router.post('/options', async (req: Request, res: Response) => {
  ...
  const opts: GenerateAuthenticationOptionsOpts = {
    ...
    userVerification: 'required',
  }
  ...
});

router.post('/result', async (req: Request, res: Response) => {
  try {
    const opts: VerifyAuthenticationResponseOpts = {
      ...
      requireUserVerification: true
    };
    ...
});
```


# ã¾ã¨ã‚

æœ¬æŠ•ç¨¿ã§ã¯ SimpleWebAuthn[^1] ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã¦ WebAuthn ã® RP ã‚’å®Ÿè£…ã—ã¦ã¿ã¾ã—ãŸã€‚

æ‰€æ„Ÿã¨ã—ã¦ã¯ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã¦å®Ÿè£…ã™ã‚‹å ´åˆã«ãŠã„ã¦ã‚‚ã€ä»¥ä¸‹ã®ã‚ˆã†ãªç‚¹ã«é–¢ã™ã‚‹ç†è§£ã¯å¿…è¦ã§ã‚ã‚‹ã¨æ„Ÿã˜ã¾ã—ãŸã€‚

 * WebAuthn ã®ç™»éŒ²ãŠã‚ˆã³èªè¨¼ãƒ•ãƒ­ãƒ¼
 * ãƒ–ãƒ©ã‚¦ã‚¶ãŠã‚ˆã³ã‚µãƒ¼ãƒãƒ¼å´ã®å‡¦ç†
 * ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰æ„å›³ã—ãŸèªè¨¼å™¨ã‚’å‘¼ã³å‡ºã™ãŸã‚ã«å¿…è¦ãª WebAuthn API ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³
 * ã‚µãƒ¼ãƒãƒ¼ã§æ„å›³ã—ãŸèªè¨¼å™¨ã‚’å—ã‘å…¥ã‚Œã‚‹ãŸã‚ã«æ¤œè¨¼ãŒå¿…è¦ãªãƒ‡ãƒ¼ã‚¿ãƒ¼ãŠã‚ˆã³ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼

ä¸€æ–¹ã§ã€WebAuthn API ã‚’å‘¼ã³å‡ºã™éš›ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã®å‹å¤‰æ›ã‚„ã€WebAuthn API ã®çµæœã®ãƒ‘ãƒ¼ã‚¹ãªã©ã¯ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå´ã«ã¦å¸åã•ã‚Œã¦ã„ã¾ã™ã€‚
ä»¥å‰ã® WebAuthn ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå°‘ãªã‹ã£ãŸçŠ¶æ³ã§ã¯ã€CBOR ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãªã©ã®å–ã‚Šæ‰±ã„ã«å¤§ããªåŠ´åŠ›ã‚’å¿…è¦ã¨ã—ã¾ã—ãŸãŒã€ã“ã†ã„ã£ãŸç‚¹ã«ã¤ã„ã¦ã¯åŸºæœ¬çš„ã«æ„è­˜ã™ã‚‹ã“ã¨ãªãå®Ÿè£…ã™ã‚‹ã“ã¨ãŒã§ããã†ã§ã™ã€‚


[^1]: SimpleWebAuthn | Introduction https://simplewebauthn.dev/docs/
[^2]: WebAuthn Awesom https://github.com/herrjemand/awesome-webauthn
[^3]: Web Authentication: An API for accessing Public Key Credentials Level 3 | 5. Web Authentication API https://www.w3.org/TR/webauthn-3/#sctn-api
[^4]: Server Requirements and Transport Binding Profile https://fidoalliance.org/specs/fido-v2.0-rd-20180702/fido-server-v2.0-rd-20180702.html
[^5]: Yahoo! JAPAN ã§ã®ç”Ÿä½“èªè¨¼ã®å–ã‚Šçµ„ã¿ï¼ˆFIDO2 ã‚µãƒ¼ãƒãƒ¼ã®ä»•çµ„ã¿ã«ã¤ã„ã¦ï¼‰https://techblog.yahoo.co.jp/advent-calendar-2018/webauthn/
[^6]: SimpleWebAuthn | Server https://simplewebauthn.dev/docs/packages/server
[^7]: SimpleWebAuthn | Browser https://simplewebauthn.dev/docs/packages/browser
[^8]: Understanding YubiKey PINs https://support.yubico.com/hc/en-us/articles/4402836718866-Understanding-YubiKey-PINs